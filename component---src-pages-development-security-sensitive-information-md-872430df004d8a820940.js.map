{"version":3,"file":"component---src-pages-development-security-sensitive-information-md-872430df004d8a820940.js","mappings":"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","sources":["webpack://commerce-php/./src/pages/development/security/sensitive-information.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"sensitive-information\"\n    }}>{`Sensitive information`}</h1>\n    <p>{`Sensitive information is information that either requires additional permissions for read/write operations or is meant to be accessed only programmatically for various reasons. Examples of sensitive information include customer passwords, addresses, date of birth, and the number of orders for a product.`}</p>\n    <h2 {...{\n      \"id\": \"exposing-sensitive-information-to-users-without-permissions\"\n    }}>{`Exposing sensitive information to users without permissions`}</h2>\n    <p>{`Let's focus on the case when an endpoint, or a page, is configured only for authenticated customers or\nadmin users with certain permissions, yet still exposes information that it shouldn't.`}</p>\n    <h3 {...{\n      \"id\": \"customer-information-example\"\n    }}>{`Customer information example`}</h3>\n    <p>{`Imagine a page or an endpoint that allows admin users to read data of a customer with the specified ID.\nThe controller/endpoint is properly configured to be accessible only by admin users that have\n`}<inlineCode parentName=\"p\">{`Magento_Customer::read_customer`}</inlineCode>{` permission for their role. When developing this functionality, a responsible service\nwould probably look something like this:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`interface CustomerQueryServiceInterface {\n    public function findById(string $id): CustomerInterface;\n}\n`}</code></pre>\n    <p>{`The service is really abstract. Most likely, it's actively used in other places where there's a need to get customer\ndata by ID. However, the `}<inlineCode parentName=\"p\">{`dob`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`addresses`}</inlineCode>{` properties also require the `}<inlineCode parentName=\"p\">{`Magento_Customer::personal_info`}</inlineCode>{` permission,\nwhich is intended for the most trusted admin users only. This creates a problem for the customer read endpoint/page:\n`}<inlineCode parentName=\"p\">{`CustomerQueryServiceInterface::findById()`}</inlineCode>{` always returns the full set of customer info, including `}<inlineCode parentName=\"p\">{`dob`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`addresses`}</inlineCode>{`.`}</p>\n    <p>{`Here's how the sensitive information will be exposed through various interfaces.`}</p>\n    <h4 {...{\n      \"id\": \"rest-web-api\"\n    }}>{`REST web API`}</h4>\n    <p>{`The application framework serializes all properties defined in `}<inlineCode parentName=\"p\">{`CustomerInterface`}</inlineCode>{` into JSON and exposes them. If the endpoint\nis configured to require `}<inlineCode parentName=\"p\">{`Magento_Customer::personal_info`}</inlineCode>{`, then admin users without it won't be able to read basic\ncustomer data. If it is configured to require `}<inlineCode parentName=\"p\">{`Magento_Customer::read_customer`}</inlineCode>{`, then admin users without\n`}<inlineCode parentName=\"p\">{`Magento_Customer::personal_info`}</inlineCode>{` can see `}<inlineCode parentName=\"p\">{`dob`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`addresses`}</inlineCode>{`.`}</p>\n    <h4 {...{\n      \"id\": \"graphql\"\n    }}>{`GraphQL`}</h4>\n    <p>{`If there are `}<inlineCode parentName=\"p\">{`dob`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`addresses`}</inlineCode>{` nodes available in the `}<inlineCode parentName=\"p\">{`schema.graphqls`}</inlineCode>{`, then these properties will be exposed to\nall admin users.`}</p>\n    <h4 {...{\n      \"id\": \"html-page-using-blocks\"\n    }}>{`HTML page using blocks`}</h4>\n    <p>{`A block gets all customer data from `}<inlineCode parentName=\"p\">{`CustomerQueryServiceInterface`}</inlineCode>{` with a high chance that the necessary\nauthorization that occurs before rendering any HTML code that contains `}<inlineCode parentName=\"p\">{`dob`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`addresses`}</inlineCode>{` will be forgotten.`}</p>\n    <h4 {...{\n      \"id\": \"html-page-using-ui-components\"\n    }}>{`HTML page using UI components`}</h4>\n    <p>{`UI components read data from a global JS object that contains all data retrieved from data providers.\nThe object is rendered into JS on the backend and is available in response HTML.\nThe data provider that uses `}<inlineCode parentName=\"p\">{`CustomerQueryServiceInterface`}</inlineCode>{` will expose full customer data inside the response HTML.`}</p>\n    <h3 {...{\n      \"id\": \"a-solution-for-the-example\"\n    }}>{`A solution for the example`}</h3>\n    <p>{`The solution is to have operation-specific DTOs and a case-specific service.`}</p>\n    <p>{`The first step is to make a case-specific service for customer data retrieval by admin users:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`interface AdminCustomerQueryServiceInterface {}\n`}</code></pre>\n    <p>{`The second step is to define operation specific DTOs:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`interface ReadCustomerDataInterface {\n    public function getId(): string;\n    public function getName(): string;\n}\n\ninterface ReadPersonalCustomerDataInterface {\n    public function getId(): string;\n    public function getDob(): \\\\DateTime;\n    public function getAddresses(): array;\n}\n`}</code></pre>\n    <p>{`The final step is to define case-specific operations:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`interface AdminCustomerQueryServiceInterface {\n    public function findById(string $id): ReadCustomerDataInterface;\n    public function findPersonalDataById(string $id): ReadPersonalCustomerDataInterface;\n}\n`}</code></pre>\n    <p>{`This service belongs in the business logic layer, so inside both these methods, you might use the same repository::method\nfrom the persistence layer. To avoid redundant calls to the repository, consider having an identity-map with full customer info\nto reuse when `}<inlineCode parentName=\"p\">{`findPersonalDataById()`}</inlineCode>{` is executed after `}<inlineCode parentName=\"p\">{`findById()`}</inlineCode>{` with the same ID.`}</p>\n    <p>{`With this approach, it is harder to expose the sensitive data accidentally. `}<inlineCode parentName=\"p\">{`findPersonalDataById()`}</inlineCode>{` will only be called\nwhen there's an explicit need to read sensitive data.`}</p>\n    <p>{`Here's how it will work for different interfaces.`}</p>\n    <h4 {...{\n      \"id\": \"html-rendered-with-backend-blocks\"\n    }}>{`HTML rendered with backend blocks`}</h4>\n    <p>{`The block will have a condition: when the user has `}<inlineCode parentName=\"p\">{`Magento_Customer::personal_info`}</inlineCode>{`, call the`}<inlineCode parentName=\"p\">{`findPersonalDataById()`}</inlineCode>{` method.\nOtherwise, leave the personal data empty.`}</p>\n    <h4 {...{\n      \"id\": \"html-rendered-on-frontend\"\n    }}>{`HTML rendered on frontend`}</h4>\n    <p>{`Inside the data provider for the UI component, the same condition listed above is present.`}</p>\n    <h4 {...{\n      \"id\": \"restsoap-web-api\"\n    }}>{`REST/SOAP web API`}</h4>\n    <p>{`Both `}<inlineCode parentName=\"p\">{`findById()`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`findPersonalDataById()`}</inlineCode>{` have their own endpoints. The first requires `}<inlineCode parentName=\"p\">{`Magento_Customer::read_customer`}</inlineCode>{`,\nwhile the second requires `}<inlineCode parentName=\"p\">{`Magento_Customer::personal_info`}</inlineCode>{`. A client that wants to render the customer info page will issue two requests:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Fetch basic customer data from the `}<inlineCode parentName=\"li\">{`findById()`}</inlineCode>{` endpoint`}</li>\n      <li parentName=\"ol\">{`Fetch personal customer data from the  `}<inlineCode parentName=\"li\">{`findPersonalDataById()`}</inlineCode>{` endpoint`}</li>\n    </ol>\n    <p>{`The second may fail with a 403 status. In this case, the client ignores the status and displays basic customer data only, assuming\nthe current admin user does not have access to `}<inlineCode parentName=\"p\">{`Magento_Customer::personal_info`}</inlineCode>{`.`}</p>\n    <h4 {...{\n      \"id\": \"graphql-1\"\n    }}>{`GraphQL`}</h4>\n    <p>{`The `}<inlineCode parentName=\"p\">{`dob`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`addresses`}</inlineCode>{` fields have their own resolvers, which will validate access to `}<inlineCode parentName=\"p\">{`Magento_Customer::personal_info`}</inlineCode>{`. If successful,\nthe resolvers call `}<inlineCode parentName=\"p\">{`findPersonalDataById()`}</inlineCode>{` and return the results.`}</p>\n    <h2 {...{\n      \"id\": \"exposing-sensitive-information-through-a-persistent-storage\"\n    }}>{`Exposing sensitive information through a persistent storage`}</h2>\n    <p>{`There is always a possibility of bad actors gaining access to persistent storage either through injection attacks,\nthrough misconfigured environment, or any other way. For that reason, you must protect sensitive information while\nit's in storage and while it's being transported by APIs or a HTML interface.`}</p>\n    <h3 {...{\n      \"id\": \"hashed-sensitive-information\"\n    }}>{`Hashed sensitive information`}</h3>\n    <p>{`Sensitive information that is never exposed in plain text after creation and is only used for comparison can be safely\nstored in the form of a hash.`}</p>\n    <p>{`Good examples include passwords, tokens, and secrets. After a password (or similar entity) is created, there is no need to ever\ndisplay it to a user again. Later on, there's only a need to compare user input to the existing password.\nA hash allows allows you to compare a value to a hashed one and to avoid exposing the original value. A salt is often used with\nhashes for passwords to prevent attacks using rainbow tables.`}</p>\n    <p><inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\Encryption\\\\EncryptorInterface`}</inlineCode>{` helps with hashes. Use `}<inlineCode parentName=\"p\">{`getHash()`}</inlineCode>{` method to generate a hash with\nor without a salt, depending on the second argument. (Using a salt is recommended.) Subsequently, use `}<inlineCode parentName=\"p\">{`isValidHash()`}</inlineCode>{` to\ncompare the user-provided value to an existing hash. These methods handle salts, choose a secure algorithm, and\nwill work after the encryption key is updated by an admin user.`}</p>\n    <h3 {...{\n      \"id\": \"encrypted-sensitive-information\"\n    }}>{`Encrypted sensitive information`}</h3>\n    <p>{`Extremely sensitive information that is only accessible to authorized users must be stored encrypted.`}</p>\n    <p>{`Private information such as addresses are good candidates for encryption, depending on your application requirements.\nEncrypting such information involves having an encryption key that is not stored in the same storage as the encrypted\ninformation.`}</p>\n    <p>{`The application handles encryption with `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\Encryption\\\\EncryptorInterface`}</inlineCode>{`. The `}<inlineCode parentName=\"p\">{`encrypt()`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`decrypt()`}</inlineCode>{`\nmethods use the encryption key for encryption and choose the most secure algorithm with decent performance.\nIt also handles old and new encryption keys and emerging best practices to encryption with regards to the algorithm.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}