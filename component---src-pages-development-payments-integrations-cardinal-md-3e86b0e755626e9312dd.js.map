{"version":3,"file":"component---src-pages-development-payments-integrations-cardinal-md-3e86b0e755626e9312dd.js","mappings":"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","sources":["webpack://commerce-php/./src/pages/development/payments-integrations/cardinal.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"cardinalcommerce-3-d-secure\"\n    }}>{`CardinalCommerce 3-D Secure`}</h1>\n    <p>{`This document provides additional technical details for integrating Adobe Commerce payment modules with the `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.cardinalcommerce.com/\"\n      }}>{`CardinalCommerce`}</a>{`. CardinalCommerce (a wholly owned subsidiary of Visa) offers a rules-based 3-D Secure (3DS) solution called `}<a parentName=\"p\" {...{\n        \"href\": \"https://cardinaldocs.atlassian.net/wiki/spaces/CC/pages/196642/Consumer+Authentication#ConsumerAuthentication-CardinalConsumerAuthentication\"\n      }}>{`Cardinal Consumer Authentication`}</a>{`. Protect your web store from fraud, reduce false declines, reduce manual review of orders, and improve your authorizations.`}</p>\n    <p>{`The integration is based on the `}<em parentName=\"p\">{`Magento_CardinalCommerce`}</em>{` module that implements the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cardinaldocs.atlassian.net/wiki/spaces/CC/pages/7929857/Cardinal+Cruise+Standard\"\n      }}>{`Cardinal Cruise Standard`}</a>{` integration approach.`}</p>\n    <p>{`The Cardinal Cruise Standard integration is purely a JavaScript approach that is all encompassing. When enabling this approach for `}<a parentName=\"p\" {...{\n        \"href\": \"https://cardinaldocs.atlassian.net/wiki/spaces/CC/pages/196642/Consumer+Authentication#ConsumerAuthentication-CardinalConsumerAuthentication\"\n      }}>{`Cardinal Consumer Authentication`}</a>{`, this integration will handle the device data collection, initiating the transaction for `}<a parentName=\"p\" {...{\n        \"href\": \"https://cardinaldocs.atlassian.net/wiki/spaces/CC/pages/196642/Consumer+Authentication#ConsumerAuthentication-CardinalConsumerAuthentication\"\n      }}>{`CCA`}</a>{`, presenting the authentication session if required, and returning the results of authentication once completed. This is recommended integration approach for CCA.`}</p>\n    <p>{`The following diagram shows a simplified 3-D Secure verification flow using Cardinal Cruise Standard integration approach provided by CardinalCommerce:`}</p>\n    <p><img parentName=\"p\" {...{\n        \"src\": \"/commerce-php/assets/f97124f6957ca1697e37c1f80abd47c9/cardinal_commerce.svg\",\n        \"alt\": \"CardinalCommerce Interaction\"\n      }}></img></p>\n    <h2 {...{\n      \"id\": \"magento_cardinalcommerce-module-overview\"\n    }}>{`Magento_CardinalCommerce module overview`}</h2>\n    <p>{`The `}<em parentName=\"p\">{`Magento_CardinalCommerce`}</em>{` `}<a parentName=\"p\" {...{\n        \"href\": \"https://glossary.magento.com/module\"\n      }}>{`module`}</a>{` allows you to:`}</p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Start `}<inlineCode parentName=\"p\">{`Cardinal Consumer Authentication`}</inlineCode>{` for enabling card network programs including Verified by Visa®, MasterCard SecureCode® and Identity Check®, American Express SafeKey®, Discover ProtectBuy® and Diners International® and JCB J-Secure®.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Handle specific return values for `}<inlineCode parentName=\"p\">{`Cardinal Consumer Authentication`}</inlineCode>{` on backend and storefront`}</p>\n      </li>\n    </ul>\n    <h2 {...{\n      \"id\": \"payment-method-module-integration-with-magento_cardinalcommerce\"\n    }}>{`Payment method module integration with Magento_CardinalCommerce`}</h2>\n    <p>{`CardinalCommerce maintains a `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.cardinalcommerce.com/partners/gateways\"\n      }}>{`list of compatible payment gateways`}</a>{`.`}</p>\n    <h3 {...{\n      \"id\": \"cardinalcommerce-configuration-for-payment-method\"\n    }}>{`CardinalCommerce configuration for payment method`}</h3>\n    <p>{`You need to add configuration parameter that will enable `}<inlineCode parentName=\"p\">{`Cardinal Consumer Authentication`}</inlineCode>{` in the `}<inlineCode parentName=\"p\">{`config.xml`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`system.xml`}</inlineCode>{` files  of your `}<a parentName=\"p\" {...{\n        \"href\": \"https://glossary.magento.com/payment-method\"\n      }}>{`payment method`}</a>{` module:`}</p>\n    <ul>\n      <li parentName=\"ul\"><inlineCode parentName=\"li\">{`enabled_{payment_method_code}`}</inlineCode>{` - enables CCA for custom payment method.`}</li>\n    </ul>\n    <p>{`The following example is the `}<inlineCode parentName=\"p\">{`config.xml`}</inlineCode>{` file of the AuthorizenetAcceptjs payment method:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"urn:magento:module:Magento_Store:etc/config.xsd\">\n    <default>\n        <three_d_secure>\n            <cardinal>\n                <enabled_authorizenet>0</enabled_authorizenet>\n            </cardinal>\n        </three_d_secure>\n    </default>\n</config>\n`}</code></pre>\n    <p>{`And the `}<inlineCode parentName=\"p\">{`system.xml`}</inlineCode>{` file of the AuthorizenetAcceptjs payment method:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"urn:magento:module:Magento_Config:etc/system_file.xsd\">\n    <system>\n        <section id=\"three_d_secure\">\n            <group id=\"cardinal\">\n                <group id=\"config\">\n                    <field id=\"enabled_authorize\" translate=\"label\" type=\"select\" sortOrder=\"10\" showInDefault=\"1\" showInWebsite=\"1\" showInStore=\"0\">\n                        <label>Enable for Authorize.Net</label>\n                        <source_model>Magento\\\\Config\\\\Model\\\\Config\\\\Source\\\\Yesno</source_model>\n                        <config_path>three_d_secure/cardinal/enabled_authorizenet</config_path>\n                    </field>\n                </group>\n            </group>\n        </section>\n    </system>\n</config>\n`}</code></pre>\n    <p>{`You can pass this parameter on storefront via checkout config using `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Checkout\\\\Model\\\\ConfigProviderInterface`}</inlineCode></p>\n    <p>{`See `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/magento/magento2/tree/2.3/app/code/Magento/AuthorizenetCardinal/Model/Checkout/ConfigProvider.php\"\n      }}>{`app\\\\code\\\\AuthorizenetCardinal\\\\Model\\\\Checkout\\\\ConfigProvider.php`}</a>{` as an example.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`namespace Magento\\\\AuthorizenetCardinal\\\\Model\\\\Checkout;\n\nuse Magento\\\\AuthorizenetCardinal\\\\Model\\\\Config;\nuse Magento\\\\Checkout\\\\Model\\\\ConfigProviderInterface;\n\n/**\n * Configuration provider.\n */\nclass ConfigProvider implements ConfigProviderInterface\n{\n    /**\n     * @var Config\n     */\n    private $config;\n\n    /**\n     * @param Config $config\n     */\n    public function __construct(\n        Config $config\n    ) {\n        $this->config = $config;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    public function getConfig(): array\n    {\n        $config['cardinal'] = [\n            'isActiveFor' => [\n                'authorizenet' => $this->config->isActive()\n            ]\n        ];\n\n        return $config;\n    }\n}\n`}</code></pre>\n    <h4 {...{\n      \"id\": \"dixml-configuration\"\n    }}><inlineCode parentName=\"h4\">{`di.xml`}</inlineCode>{` configuration`}</h4>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"urn:magento:framework:ObjectManager/etc/config.xsd\">\n    <type name=\"Magento\\\\Checkout\\\\Model\\\\CompositeConfigProvider\">\n        <arguments>\n            <argument name=\"configProviders\" xsi:type=\"array\">\n                <item name=\"authorizenet_cardinal_config_provider\" xsi:type=\"object\">\n                    Magento\\\\AuthorizenetCardinal\\\\Model\\\\Checkout\\\\ConfigProvider\n                </item>\n            </argument>\n        </arguments>\n    </type>\n</config>\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"start-cardinal-consumer-authentication\"\n    }}>{`Start Cardinal Consumer Authentication`}</h3>\n    <p>{`CCA is initiated by the merchant, typically when the customer clicks `}<inlineCode parentName=\"p\">{`Place Order`}</inlineCode>{` button. Instead of getting a card authorization, you should use the `}<inlineCode parentName=\"p\">{`Magento_CardinalCommerce/view/frontend/web/js/cardinal-client`}</inlineCode>{` JS component and initiate the CCA process before authorization.`}</p>\n    <p>{`In the following example mixin, `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/magento/magento2/tree/2.3/app/code/Magento/AuthorizenetCardinal/view/frontend/web/js/authorizenet-accept-mixin.js\"\n      }}>{`app/code/Magento/AuthorizenetCardinal/view/frontend/web/js/authorizenet-accept-mixin.js`}</a>{` is used to intercept the `}<inlineCode parentName=\"p\">{`placeOrder`}</inlineCode>{` method of the AuthorizenetAcceptjs payment method JS component and start consumer authentication:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`define([\n     ...\n    'Magento_CardinalCommerce/js/cardinal-client',\n     ...\n], function ($, cardinalClient, ...) {\n    'use strict';\n\n    return function (originalComponent) {\n        return originalComponent.extend({\n            defaults: {\n                cardinalJWT: null\n            },\n\n            /**\n             * Performs 3d-secure authentication.\n             */\n            beforePlaceOrder: function () {\n                var original = this._super.bind(this),\n                    client = cardinalClient,\n                    isActive = window.checkoutConfig.cardinal.isActiveFor.authorizenet,\n                    cardData;\n\n                if (!isActive || !$(this.formElement).valid()) {\n                    return original();\n                }\n\n                cardData = {\n                    accountNumber: this.creditCardNumber(),\n                    expMonth: this.creditCardExpMonth(),\n                    expYear: this.creditCardExpYear()\n                };\n\n                if (this.hasVerification()) {\n                    cardData.cardCode = this.creditCardVerificationNumber();\n                }\n\n                client.startAuthentication(cardData)\n                    .done(function (jwt) {\n                        this.cardinalJWT = jwt;\n                        original();\n                    }.bind(this))\n                    .fail(function (errorMessage) {\n                        globalMessageList.addErrorMessage({\n                            message: errorMessage\n                        });\n                    });\n                ...\n            },\n\n            /**\n             * Adds cardinal response JWT to payment additional data.\n             *\n             * @returns {Object}\n             */\n            getData: function () {\n                var originalData = this._super();\n\n                originalData['additional_data'].cardinalJWT = this.cardinalJWT;\n\n                return originalData;\n            }\n        });\n    };\n});\n`}</code></pre>\n    <p>{`Once the response `}<a parentName=\"p\" {...{\n        \"href\": \"https://en.wikipedia.org/wiki/JSON_Web_Token\"\n      }}>{`JWT`}</a>{` is received after consumer authentication, you will need to send it to your backend to verify and extract the results. In the example above response JWT is added to payment additional data and passed to backend along with them.`}</p>\n    <h3 {...{\n      \"id\": \"cca-results-extracting-and-validation-on-backend\"\n    }}>{`CCA Results Extracting And Validation On Backend`}</h3>\n    <p>{`Cardinal Consumer Authentication results can be extracted from CardinalCommerce response JWT with `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\CardinalCommerce\\\\Model\\\\Response\\\\JwtParserInterface`}</inlineCode>{`. Basic implementation of this interface includes response JWT signature validation, and validation of parameters such as `}<inlineCode parentName=\"p\">{`ActionCode`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`ErrorNumber`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`ECIFlag`}</inlineCode>{`. You can find detailed information about these parameters in `}<a parentName=\"p\" {...{\n        \"href\": \"https://cardinaldocs.atlassian.net/wiki/spaces/CC/pages/98315/Response+Objects\"\n      }}>{`API Reference`}</a>{`.`}</p>\n    <p>{`You can customize CCA results validation by creating your own implementation of `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\CardinalCommerce\\\\Model\\\\Response\\\\JwtPayloadValidatorInterface`}</inlineCode>{`.`}</p>\n    <p>{`Below is an example of the extracting array content of a CardinalCommerce response JWT in `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/magento/magento2/tree/2.3/app/code/Magento/AuthorizenetCardinal/Gateway/Request/Authorize3DSecureBuilder.php\"\n      }}>{`\\\\Magento\\\\AuthorizenetCardinal\\\\Gateway\\\\Request\\\\Authorize3DSecureBuilder`}</a>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`use Magento\\\\AuthorizenetAcceptjs\\\\Gateway\\\\SubjectReader;\nuse Magento\\\\AuthorizenetCardinal\\\\Model\\\\Config;\nuse Magento\\\\CardinalCommerce\\\\Model\\\\Response\\\\JwtParserInterface;\nuse Magento\\\\Payment\\\\Gateway\\\\Request\\\\BuilderInterface;\nuse Magento\\\\Sales\\\\Model\\\\Order\\\\Payment;\n\n/**\n * Adds the cardholder authentication information to the request\n */\nclass Authorize3DSecureBuilder implements BuilderInterface\n{\n    /**\n     * @var SubjectReader\n     */\n    private $subjectReader;\n\n    /**\n     * @var Config\n     */\n    private $config;\n\n    /**\n     * @var JwtParserInterface\n     */\n    private $jwtParser;\n\n    /**\n     * @param SubjectReader $subjectReader\n     * @param Config $config\n     * @param JwtParserInterface $jwtParser\n     */\n    public function __construct(\n        SubjectReader $subjectReader,\n        Config $config,\n        JwtParserInterface $jwtParser\n    ) {\n        $this->subjectReader = $subjectReader;\n        $this->config = $config;\n        $this->jwtParser = $jwtParser;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    public function build(array $buildSubject): array\n    {\n        if ($this->config->isActive() === false) {\n            return [];\n        }\n\n        $paymentDO = $this->subjectReader->readPayment($buildSubject);\n        $payment = $paymentDO->getPayment();\n        $data = [];\n\n        if ($payment instanceof Payment) {\n            $cardinalJwt = (string)$payment->getAdditionalInformation('cardinalJWT');\n            $jwtPayload = $this->jwtParser->execute($cardinalJwt);\n            $eciFlag = $jwtPayload['Payload']['Payment']['ExtendedData']['ECIFlag'] ?? '';\n            $cavv = $jwtPayload['Payload']['Payment']['ExtendedData']['CAVV'] ?? '';\n            $data = [\n                'transactionRequest' => [\n                    'cardholderAuthentication' => [\n                        'authenticationIndicator' => $eciFlag,\n                        'cardholderAuthenticationValue' => $cavv\n                    ],\n                ]\n            ];\n        }\n\n        return $data;\n    }\n}\n`}</code></pre>\n    <p>{`Depending on the requirements of your payment gateway, you should include some of the response fields in the transaction request, or you should perform a separate request based on these values.`}</p>\n    <p>{`In our example, the `}<inlineCode parentName=\"p\">{`ECIFlag`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`CAVV`}</inlineCode>{` values were included in the transaction request to Authorize.Net.`}</p>\n    <p>{`Then you can expect to see an additional field with a cardholder authentication verification response code in the response from your payment gateway. This code lets you know whether the information got back to the issuer. If the issuer recognizes this data as matching whatever they recorded earlier in the transaction when the cardholder was authenticating, they will respond with a successful code in this field.`}</p>\n    {\n      /* Link Definitions */\n    }\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}