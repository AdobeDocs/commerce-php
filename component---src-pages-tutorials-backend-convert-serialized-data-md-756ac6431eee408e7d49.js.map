{"version":3,"file":"component---src-pages-tutorials-backend-convert-serialized-data-md-756ac6431eee408e7d49.js","mappings":"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","sources":["webpack://commerce-php/./src/pages/tutorials/backend/convert-serialized-data.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"convert-serialized-data-to-json\"\n    }}>{`Convert serialized data to JSON`}</h1>\n    <p>{`The following tutorial lists the steps needed to create an upgrade script that converts the data stored in the database from the default PHP serialized format to JSON format.`}</p>\n    <p>{`Use this tutorial to create an upgrade script to update your extension to work with Adobe Commerce and Magento Open Source 2.2 and above.`}</p>\n    <h2 {...{\n      \"id\": \"before-you-begin\"\n    }}>{`Before you begin`}</h2>\n    <p>{`Identify the data you need to convert to JSON in the database.`}</p>\n    <p>{`Your extension `}<em parentName=\"p\">{`must`}</em>{` convert data in the following cases:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`The extension stores serialized data provided by a core module that now uses the JSON format.`}</li>\n      <li parentName=\"ol\">{`The extension uses the automatic serializing mechanism provided by the Magento framework (i.e. the extension declares `}<inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\Model\\\\ResourceModel\\\\Db\\\\AbstractDb::$_serializableFields`}</inlineCode>{`).`}</li>\n    </ol>\n    <p>{`Your extension will continue working in Adobe Commerce and Magento Open Source 2.2 and above in the following cases, but we recommend you switch to using the JSON format for security reasons:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`The extension stores its own serialized data.`}</li>\n      <li parentName=\"ol\">{`The extension is responsible for serializing and unserializing data stored in core tables.`}</li>\n    </ol>\n    <h3 {...{\n      \"id\": \"api-overview\"\n    }}>{`API Overview`}</h3>\n    <p>{`This tutorial uses the following framework API in the following ways:`}</p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\DB\\\\FieldDataConverter`}</inlineCode>{` - This class converts values for a field in a table from one format to another.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\DB\\\\FieldDataConverterFactory`}</inlineCode>{` - This class creates instances of the `}<inlineCode parentName=\"li\">{`FieldDataConverter`}</inlineCode>{` with the appropriate data converter implementation.`}</li>\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\DB\\\\AggregatedFieldDataConverter`}</inlineCode>{` - This is a service class that allows specifying multiple fields from different tables at once. This class creates instances of the `}<inlineCode parentName=\"li\">{`FieldDataConverter`}</inlineCode>{` class and accepts a list of `}<inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\DB\\\\FieldToConvert`}</inlineCode>{` value objects with field information. A single `}<inlineCode parentName=\"li\">{`convert()`}</inlineCode>{` method call is limited to one DB connection.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\DB\\\\DataConverter\\\\DataConverterInterface`}</inlineCode>{` - This interface is for classes that convert data between different formats or types of data.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\DB\\\\FieldDataConverter`}</inlineCode>{` - This class accepts query modifiers for updating specific rows. Here is API for the query modifiers part:`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\DB\\\\Select\\\\QueryModifierInterface`}</inlineCode>{` - Interface for classes that add a condition to the database query to target specific entries.`}</li>\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\DB\\\\Select\\\\QueryModifierFactory`}</inlineCode>{` - This class creates instances of specific implementations of `}<inlineCode parentName=\"li\">{`QueryModifierInterface`}</inlineCode>{`.`}</li>\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\DB\\\\Select\\\\InQueryModifier`}</inlineCode>{` - An implementation of the `}<inlineCode parentName=\"li\">{`QueryModifierInterface`}</inlineCode>{` that adds an IN condition to a query.`}</li>\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\DB\\\\Select\\\\LikeQueryModifier`}</inlineCode>{` - An implementation of the `}<inlineCode parentName=\"li\">{`QueryModifierInterface`}</inlineCode>{` that adds a LIKE condition to a query.`}</li>\n          <li parentName=\"ul\"><inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\DB\\\\Select\\\\CompositeQueryModifier`}</inlineCode>{` - An implementation of the `}<inlineCode parentName=\"li\">{`QueryModifierInterface`}</inlineCode>{` that allows the application of multiple query modifiers.`}</li>\n        </ul>\n        <p parentName=\"li\">{`You can create your own query modifier or use any of the ones listed in the `}<inlineCode parentName=\"p\">{`app/etc/di.xml`}</inlineCode>{` file.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\Module\\\\Manager`}</inlineCode>{` - This class checks the status of a module.`}</p>\n      </li>\n    </ul>\n    <h2 {...{\n      \"id\": \"step-1-create-the-basic-upgrade-script\"\n    }}>{`Step 1: Create the basic upgrade script`}</h2>\n    <p>{`The upgrade script is what runs during the upgrade step of your extension's `}{`[lifecycle][1]`}{`.\nCreate the `}<inlineCode parentName=\"p\">{`UpgradeData.php`}</inlineCode>{` file in the `}<inlineCode parentName=\"p\">{`Setup`}</inlineCode>{` directory inside your extension's root directory.`}</p>\n    <p>{`Inside the file, create the class `}<inlineCode parentName=\"p\">{`UpgradeData`}</inlineCode>{` which implements `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\Setup\\\\UpgradeDataInterface`}</inlineCode>{`.`}</p>\n    <p>{`Example upgrade script content:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`<?php\n/**\n * Copyright &copy; Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\nnamespace Magento\\\\CustomModule\\\\Setup;\n\nuse Magento\\\\Framework\\\\DB\\\\FieldDataConverterFactory;\nuse Magento\\\\Framework\\\\DB\\\\Query\\\\Generator;\nuse Magento\\\\Framework\\\\DB\\\\Select\\\\QueryModifierFactory;\nuse Magento\\\\Framework\\\\Setup\\\\ModuleContextInterface;\nuse Magento\\\\Framework\\\\Setup\\\\ModuleDataSetupInterface;\nuse Magento\\\\Framework\\\\Setup\\\\UpgradeDataInterface;\n\nclass UpgradeData implements UpgradeDataInterface\n{\n    /**\n     * @var FieldDataConverterFactory\n     */\n    private $fieldDataConverterFactory;\n\n    /**\n     * @var QueryModifierFactory\n     */\n    private $queryModifierFactory;\n\n    /**\n     * @var Generator\n     */\n    private $queryGenerator;\n\n    /**\n     * Constructor\n     *\n     * @param FieldDataConverterFactory $fieldDataConverterFactory\n     * @param QueryModifierFactory $queryModifierFactory\n     * @param Generator $queryGenerator\n     */\n    public function __construct(\n        FieldDataConverterFactory $fieldDataConverterFactory,\n        QueryModifierFactory $queryModifierFactory,\n        Generator $queryGenerator\n    ) {\n        $this->fieldDataConverterFactory = $fieldDataConverterFactory;\n        $this->queryModifierFactory = $queryModifierFactory;\n        $this->queryGenerator = $queryGenerator;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function upgrade(\n        ModuleDataSetupInterface $setup,\n        ModuleContextInterface $context\n    ) {\n        if (version_compare($context->getVersion(), '2.0.1', '<')) {\n            $this->convertSerializedDataToJson($setup);\n        }\n    }\n\n    /**\n     * Upgrade to version 2.0.1, convert data for the sales_order_item.product_options and quote_item_option.value\n     * from serialized to JSON format\n     *\n     * @param ModuleDataSetupInterface $setup\n     * @return void\n     */\n    private function convertSerializedDataToJson(ModuleDataSetupInterface $setup)\n    {\n        // Upgrade logic here\n    }\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"step-2-check-that-the-module-exists\"\n    }}>{`Step 2: Check that the module exists`}</h2>\n    <p>{`Any module can replace another module.\nIf your extension stores data in the tables of another module or it serializes or unserializes data stored in core modules, make sure the module exists and is active before executing the upgrade logic.`}</p>\n    <p>{`Use the `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\Module\\\\Manager`}</inlineCode>{` class to check the status of the module your extension depends on.`}</p>\n    <p>{`Add this dependency in the constructor of your upgrade script class:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`if ($this->moduleManager->isEnabled('Magento_Sales')) {\n    // Upgrade logic goes here\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"step-3-write-the-conversion-logic\"\n    }}>{`Step 3: Write the conversion logic`}</h2>\n    <p>{`The conversion logic in your script depends on how your extension stores the serialized data.`}</p>\n    <p>{`If your extension stores serialized data in different ways, you will need to use different conversion methods.`}</p>\n    <h3 {...{\n      \"id\": \"step-3a-convert-data-in-a-column-for-all-rows\"\n    }}>{`Step 3a: Convert data in a column for all rows`}</h3>\n    <p>{`Use a `}<inlineCode parentName=\"p\">{`FieldDataConverterFactory`}</inlineCode>{` to create a `}<inlineCode parentName=\"p\">{`FieldDataConverter`}</inlineCode>{` instance with the appropriate data converter.`}</p>\n    <p>{`Convert data for a column in a table using:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`$fieldDataConverter = $this->fieldDataConverterFactory->create(SerializedToJson::class);\n\n$fieldDataConverter->convert(\n    $setup->getConnection(),\n    $setup->getTable('my_table'),\n    'entity_id',\n    'field'\n);\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"step-3b-convert-data-in-specific-rows-for-a-field\"\n    }}>{`Step 3b: Convert data in specific rows for a field`}</h3>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`option_id`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`code`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`value`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`1`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`my_option`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`a:1:{s:3:\"foo\";s:3:\"bar\";}`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`2`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`another_option`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`<`}{`non-serialized string`}{`>`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`3`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`my_option`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`a:1:{s:3:\"foo\";s:3:\"bar\";}`}</inlineCode></td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`If you need to convert specific rows in the column, you can use a query modifier to update values using a condition.`}</p>\n    <p>{`The following code sample upgrades the data for options in the `}<inlineCode parentName=\"p\">{`value`}</inlineCode>{` column in the `}<inlineCode parentName=\"p\">{`quote_item_option`}</inlineCode>{` table with the code `}<inlineCode parentName=\"p\">{`my_option`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`use Magento\\\\Framework\\\\DB\\\\DataConverter\\\\SerializedToJson;\n\n$fieldDataConverter = $this->fieldDataConverterFactory->create(\n    SerializedToJson::class\n);\n\n// Convert data for the option with static name in quote_item_option.value\n$queryModifier = $this->queryModifierFactory->create(\n    'in',\n    [\n        'values' => [\n            'code' => [\n                'my_option'\n            ]\n        ]\n    ]\n);\n$fieldDataConverter->convert(\n    $setup->getConnection(),\n    $setup->getTable('quote_item_option'),\n    'option_id',\n    'value',\n    $queryModifier\n);\n`}</code></pre>\n    <h4 {...{\n      \"id\": \"use-values-from-another-table-in-the-condition\"\n    }}>{`Use values from another table in the condition`}</h4>\n    <p>{`The following tables show how the `}<inlineCode parentName=\"p\">{`type`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`option_id`}</inlineCode>{` columns from the `}<inlineCode parentName=\"p\">{`catalog_product_option`}</inlineCode>{` table form the unique `}<inlineCode parentName=\"p\">{`code`}</inlineCode>{` value for custom options in the `}<inlineCode parentName=\"p\">{`quote_item_option`}</inlineCode>{` table.`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\"><inlineCode parentName=\"p\">{`catalog_product_option`}</inlineCode>{` table`}</p>\n    </blockquote>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`option_id`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`product_id`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`type`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`1001`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`1`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`my_custom_option`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`1002`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`2`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`my_custom_option`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`1003`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`5`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`my_custom_option`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <blockquote>\n      <p parentName=\"blockquote\"><inlineCode parentName=\"p\">{`quote_item_option`}</inlineCode>{` table`}</p>\n    </blockquote>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`option_id`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`code`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`value`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`1`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`my_custom_option_1001`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`a:1:{s:3:\"foo\";s:3:\"bar\";}`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`2`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`another_option`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`<`}{`non-serialized string`}{`>`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`3`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`my_custom_option_1002`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`a:1:{s:3:\"foo\";s:3:\"bar\";}`}</inlineCode></td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`4`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`my_custom_option_1003`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`a:1:{s:3:\"foo\";s:3:\"bar\";}`}</inlineCode></td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`To update custom options data in the `}<inlineCode parentName=\"p\">{`quote_item_option`}</inlineCode>{` table:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`use Magento\\\\Framework\\\\DB\\\\DataConverter\\\\SerializedToJson;\n\n$fieldDataConverter = $this->fieldDataConverterFactory->create(\n    SerializedToJson::class\n);\n// Convert data for the option with dynamic name in quote_item_option.value\n$select = $setup->getConnection()\n    ->select()\n    ->from(\n        $setup->getTable('catalog_product_option'),\n        ['option_id']\n    )\n    ->where('type = ?', 'my_custom_option');\n$iterator = $this->queryGenerator->generate('option_id', $select);\nforeach ($iterator as $selectByRange) {\n    $codes = $setup->getConnection()->fetchCol($selectByRange);\n    $codes = array_map(\n        function ($id) {\n            return 'my_custom_option_' . $id;\n        },\n        $codes\n    );\n    $queryModifier = $this->queryModifierFactory->create(\n        'in',\n        [\n            'values' => [\n                'code' => $codes\n            ]\n        ]\n    );\n    $fieldDataConverter->convert(\n        $setup->getConnection(),\n        $setup->getTable('quote_item_option'),\n        'option_id',\n        'value',\n        $queryModifier\n    );\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"step-3c-convert-nested-serialized-data\"\n    }}>{`Step 3c: Convert nested serialized data`}</h3>\n    <p>{`If your module uses nested serialized data in the database, create a custom data converter to hold the logic for converting the data.`}</p>\n    <p>{`The following example is a custom data converter class that converts data in the `}<inlineCode parentName=\"p\">{`product_options`}</inlineCode>{` column in the `}<inlineCode parentName=\"p\">{`sales_order_item`}</inlineCode>{` table.\nThis field contains nested serialized data that needs conversion.`}</p>\n    <p>{`Since you cannot assume the format of the data when initially converted, the following example also checks the format and uses the appropriate methods to unserialize and serialize the data using the original format.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`<?php\n/**\n * Copyright &copy; Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\nnamespace Magento\\\\CustomModule\\\\Setup;\n\nuse Magento\\\\Framework\\\\DB\\\\DataConverter\\\\DataConverterInterface;\nuse Magento\\\\Framework\\\\Serialize\\\\Serializer\\\\Json;\nuse Magento\\\\Framework\\\\Serialize\\\\Serializer\\\\Serialize;\n\n/**\n * Serializer used to convert data in product_options field\n */\nclass SerializedToJsonDataConverter implements DataConverterInterface\n{\n    /**\n     * @var Serialize\n     */\n    private $serialize;\n\n    /**\n     * @var Json\n     */\n    private $json;\n\n    /**\n     * Constructor\n     *\n     * @param Serialize $serialize\n     * @param Json $json\n     */\n    public function __construct(\n        Serialize $serialize,\n        Json $json\n    ) {\n        $this->serialize = $serialize;\n        $this->json = $json;\n    }\n\n    /**\n     * Convert from serialized to JSON format\n     *\n     * @param string $value\n     * @return string\n     */\n    public function convert($value)\n    {\n        $isSerialized = $this->isSerialized($value);\n        $unserialized = $isSerialized\n          ? $this->serialize->unserialize($value)\n          : $this->json->unserialize($value);\n        if (isset($unserialized['options'])) {\n            foreach ($unserialized['options'] as $key => $option) {\n                if ($option['option_type'] === 'my_custom_option') {\n                    $unserialized['options'][$key]['option_value'] = $this->json->serialize(\n                        $this->serialize->unserialize(\n                            $option['option_value']\n                        )\n                    );\n                }\n            }\n        }\n        if (isset($unserialized['my_option'])) {\n            $unserialized['my_option'] = $this->json->serialize(\n                $this->serialize->unserialize(\n                    $unserialized['my_option']\n                )\n            );\n        }\n        return $isSerialized\n          ? $this->serialize->serialize($unserialized)\n          : $this->json->serialize($unserialized);\n    }\n\n    /**\n     * Check if value is serialized string\n     *\n     * @param string $value\n     * @return boolean\n     */\n    private function isSerialized($value)\n    {\n        return (boolean) preg_match('/^((s|i|d|b|a|O|C):|N;)/', $value);\n    }\n}\n`}</code></pre>\n    <p>{`After creating your custom data converter class, use the `}<inlineCode parentName=\"p\">{`FieldDataConverterFactory`}</inlineCode>{` to create a `}<inlineCode parentName=\"p\">{`FieldDataConverter`}</inlineCode>{` instance with your custom converter:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`use Magento\\\\CustomModule\\\\Setup\\\\SerializedToJsonDataConverter;\n\n// Convert options in sales_order_item.product_options\n$fieldDataConverter = $this->fieldDataConverterFactory->create(\n    SerializedToJsonDataConverter::class\n);\n$fieldDataConverter->convert(\n    $setup->getConnection(),\n    $setup->getTable('sales_order_item'),\n    'item_id',\n    'product_options'\n);\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"step-3d-convert-data-in-a-multi-database-setup\"\n    }}>{`Step 3d: Convert data in a multi-database setup`}</h3>\n    <p>{`Adobe Commerce supports storing Quote, Sales, and Inventory data in separate databases.\nUse the specific connections for each of these modules to update your extension's stored data for the entities of these modules.`}</p>\n    <p>{`The following code sample obtains the Sales module connection and uses it during data update.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`use Magento\\\\Sales\\\\Setup\\\\SalesSetupFactory;\n\n/** SalesSetupFactory $salesSetup */\n$salesSetup = $this->salesSetupFactory->create(['setup' => $setup]);\n\n$fieldDataConverter->convert(\n    $salesSetup->getConnection(),\n    $salesSetup->getTable('sales_order_item'),\n    'item_id',\n    'product_options'\n);\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"step-3e-convert-data-from-multiple-fields\"\n    }}>{`Step 3e: Convert data from multiple fields`}</h3>\n    <p>{`Use the `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\DB\\\\AggregatedFieldDataConverter`}</inlineCode>{` class to update multiple files instead of `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\DB\\\\FieldDataConverter`}</inlineCode>{`.`}</p>\n    <p>{`The following code sample updates two fields in different tables taking into account setup version of the module.\nIt is possible to aggregate fields for the same connection only. If it is necessary to use multiple connections in one setup script, multiple calls to `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\DB\\\\AggregatedFieldDataConverter::convert()`}</inlineCode>{` must be made.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`use Magento\\\\Sales\\\\Setup\\\\SalesSetupFactory;\n\n/** SalesSetupFactory $salesSetup */\n$salesSetup = $this->salesSetupFactory->create(['setup' => $setup]);\n\n$fieldsToUpdate = [\n    new FieldToConvert(\n        SerializedToJson::class,\n        $salesSetup->getTable('sales_invoice_item'),\n        'entity_id',\n        'tax_ratio'\n    ),\n];\nif (version_compare($setupVersion, '2.0.5', '<')) {\n    $fieldsToUpdate[] = new FieldToConvert(\n        SerializedDataConverter::class,\n        $salesSetup->getTable('sales_order_item'),\n        'item_id',\n        'product_options'\n    );\n}\n$this->aggregatedFieldConverter->convert($fieldsToUpdate, $salesSetup->getConnection());\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}