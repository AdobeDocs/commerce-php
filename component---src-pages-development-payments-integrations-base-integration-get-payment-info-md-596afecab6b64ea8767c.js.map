{"version":3,"file":"component---src-pages-development-payments-integrations-base-integration-get-payment-info-md-596afecab6b64ea8767c.js","mappings":"qMAWsBA,E,kFAFTC,EAAe,CAAC,EAOvBC,GALgBF,EAKY,cALJ,SAA6BG,GAEzD,OADAC,QAAQC,KAAK,aAAeL,EAAO,4EAC5B,eAASG,EACjB,GAGKG,EAAc,CAClBL,aAAAA,GAEIM,EAAYC,EAAAA,EACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGP,GACF,YACD,OAAO,SAACI,GAAD,UAAeD,EAAiBH,EAAhC,CAAuCO,WAAYA,EAAYC,QAAQ,eAI5E,SAAC,UAAD,CAAMA,QAAQ,UACd,eACE,GAAM,oDADR,qDAGA,8MACA,yKACA,qHACA,eACE,GAAM,yEADR,+CAEkD,uBAAYC,WAAW,MAAvB,WAFlD,yBAGA,wCAAyB,uBAAYA,WAAW,KAAvB,6BAAzB,oEAAkK,uBAAYA,WAAW,KAAvB,4DAAlK,kLACA,kEAAmD,cAAGA,WAAW,IAC7D,KAAQ,gFADuC,wBAAnD,kGAIA,uEACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,6sBA4BL,8KACA,SAACV,EAAD,CAAaW,QAAQ,OAAOC,MAAM,OAAOH,QAAQ,iBACjD,oTACA,eACE,GAAM,wDADR,yDAGA,mRAEA,sFAAuE,uBAAYC,WAAW,KAAvB,aAAvE,gBACF,cAAGA,WAAW,IACR,KAAQ,wIADd,wBADE,MAIA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,w8BAuCL,0BAAW,uBAAYA,WAAW,KAAvB,aAAX,0OAEgB,cAAGA,WAAW,IAC1B,KAAQ,yFADI,aAFhB,MAKA,eACE,GAAM,wBADR,yBAGA,gMAEF,cAAGA,WAAW,IACR,KAAQ,iHADd,8BAFE,8BAKA,uDACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,2hCAuCL,2EAA4D,uBAAYA,WAAW,KAAvB,8BAA5D,OACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,0VAQL,sDAAuC,cAAGA,WAAW,IACjD,KAAQ,kGAD2B,yBAAvC,kBAGA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,quBAyBL,4CACA,oBACE,eAAIA,WAAW,OACb,cAAGA,WAAW,OAAK,uBAAYA,WAAW,KAAvB,2CAAnB,6EAEF,eAAIA,WAAW,OACb,cAAGA,WAAW,OAAK,uBAAYA,WAAW,KAAvB,8BAAnB,8CAGJ,gKAGH,CAEDH,EAAWM,gBAAiB,C","sources":["webpack://commerce-php/./src/pages/development/payments-integrations/base-integration/get-payment-info.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nimport Docs from '/src/pages/_includes/braintree-note.md';\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst InlineAlert = makeShortcode(\"InlineAlert\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <Docs mdxType=\"Docs\" />\n    <h1 {...{\n      \"id\": \"get-payment-information-from-frontend-to-backend\"\n    }}>{`Get payment information from frontend to backend`}</h1>\n    <p>{`To implement transaction authorization our payment should receive some payment details from the payment form, like credit card details, and send received details to payment processor.`}</p>\n    <p>{`Depending on your payment integration, payment details might include credit card details, tokenized cards, payment nonce, and similar information.`}</p>\n    <p>{`However, in any case you should write some code to retrieve payment details from payment form.`}</p>\n    <h2 {...{\n      \"id\": \"example-braintree-request-builder-for-the-payment-part-of-the-request\"\n    }}>{`Example: Braintree request builder for the `}<inlineCode parentName=\"h2\">{`payment`}</inlineCode>{` part of the request`}</h2>\n    <p>{`We have specified `}<inlineCode parentName=\"p\">{`BraintreeAuthorizeRequest`}</inlineCode>{` builder composite to process authorization and it includes the `}<inlineCode parentName=\"p\">{`Magento\\\\Braintree\\\\Gateway\\\\Request\\\\PaymentDataBuilder`}</inlineCode>{` builder. This is builder responsible for the payment information part of the request, in other words, the credit card information. Let's look closer at it's implementation.`}</p>\n    <p>{`The Braintree payment provider requires the `}<a parentName=\"p\" {...{\n        \"href\": \"https://developers.braintreepayments.com/start/overview#payment-method-nonce\"\n      }}>{`payment method nonce`}</a>{`\nto process transactions, and our builder should send it for each authorization transaction.`}</p>\n    <p>{`Here is how the Braintree payment builder looks:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`class PaymentDataBuilder implements BuilderInterface\n{\n    /**\n     * @inheritdoc\n     */\n    public function build(array $buildSubject)\n    {\n        $paymentDO = $this->subjectReader->readPayment($buildSubject);\n\n        $payment = $paymentDO->getPayment();\n        $order = $paymentDO->getOrder();\n\n        $result = [\n            self::AMOUNT => $this->formatPrice($this->subjectReader->readAmount($buildSubject)),\n            self::PAYMENT_METHOD_NONCE => $payment->getAdditionalInformation(\n                DataAssignObserver::PAYMENT_METHOD_NONCE\n            ),\n            self::ORDER_ID => $order->getOrderIncrementId()\n        ];\n\n        ...\n\n        return $result;\n    }\n}\n`}</code></pre>\n    <p>{`As you can see, we get the payment nonce from payment additional information. And so any specific data (like credit card information) can be retrieved.`}</p>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`You should remove any sensitive data (like credit card details) from payment additional information when you do not use it in your code. You can remove it in request builder, after reading, or in response handler, after processing response. In other case it will be stored in database.`}</p>\n    <h2 {...{\n      \"id\": \"getting-payment-information-from-frontend-to-backend\"\n    }}>{`Getting payment information from frontend to backend`}</h2>\n    <p>{`In most cases, customers fill all required information (credit card, expiration date, billing address, etc) on checkout payment form.\nSo our payment method implementation should provide the ability to display and process payment form on checkout step.`}</p>\n    <p>{`We can send to backend any specific data, just need to override `}<inlineCode parentName=\"p\">{`getData()`}</inlineCode>{` method in\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/magento/magento2/tree/2.3/app/code/Magento/Braintree/view/frontend/web/js/view/payment/method-renderer/cc-form.js\"\n      }}>{`payment UI component`}</a>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`define(\n    [..., 'Magento_Payment/js/view/payment/cc-form', ...],\n    function (..., Component, ...) {\n        'use strict';\n\n        return Component.extend({\n            defaults: {\n                ...\n                paymentMethodNonce: null,\n            },\n            ...\n\n            getData: function () {\n                var data = {\n                    'method': this.getCode(),\n                    'additional_data': {\n                        'payment_method_nonce': this.paymentMethodNonce\n                    }\n                };\n\n                return data;\n            },\n\n            setPaymentMethodNonce: function (paymentMethodNonce) {\n                this.paymentMethodNonce = paymentMethodNonce;\n            },\n\n            beforePlaceOrder: function (data) {\n                this.setPaymentMethodNonce(data.nonce);\n                this.placeOrder();\n            },\n\n            ...\n        });\n    }\n);\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`getData()`}</inlineCode>{` method returns data what we need and depending on payment integration the returned data can be more\ncomplicated. we need last step to retrieve data from storefront in the backend. Adobe Commerce provides some\nmechanisms called `}<a parentName=\"p\" {...{\n        \"href\": \"https://devdocs.magento.com/guides/v2.4/extension-dev-guide/events-and-observers.html\"\n      }}>{`Observers`}</a>{`.`}</p>\n    <h3 {...{\n      \"id\": \"read-additional-data\"\n    }}>{`Read additional data`}</h3>\n    <p>{`You need to add an observer to retrieve additional data from payment form and store it\nin the payment additional information. In most cases it will be enough to extend\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/magento/magento2/tree/2.4/app/code/Magento/Payment/Observer/AbstractDataAssignObserver.php\"\n      }}>{`AbstractDataAssignObserver`}</a>{` and add custom behavior.`}</p>\n    <p>{`That's how observer might looks:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`class DataAssignObserver extends AbstractDataAssignObserver\n{\n    const PAYMENT_METHOD_NONCE = 'payment_method_nonce';\n\n    /**\n     * @var array\n     */\n    protected $additionalInformationList = [\n        self::PAYMENT_METHOD_NONCE,\n    ];\n\n    /**\n     * @param Observer $observer\n     * @return void\n     */\n    public function execute(Observer $observer)\n    {\n        $data = $this->readDataArgument($observer);\n\n        $additionalData = $data->getData(PaymentInterface::KEY_ADDITIONAL_DATA);\n        if (!is_array($additionalData)) {\n            return;\n        }\n\n        $paymentInfo = $this->readPaymentModelArgument($observer);\n\n        foreach ($this->additionalInformationList as $additionalInformationKey) {\n            if (isset($additionalData[$additionalInformationKey])) {\n                $paymentInfo->setAdditionalInformation(\n                    $additionalInformationKey,\n                    $additionalData[$additionalInformationKey]\n                );\n            }\n        }\n    }\n}\n`}</code></pre>\n    <p>{`And this observer should be added to list of events (`}<inlineCode parentName=\"p\">{`Module_Name/etc/events.xml`}</inlineCode>{`):`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"urn:magento:framework:Event/etc/events.xsd\">\n    <event name=\"payment_method_assign_data_braintree\">\n        <observer name=\"braintree_gateway_data_assign\" instance=\"Magento\\\\Braintree\\\\Observer\\\\DataAssignObserver\" />\n    </event>\n</config>\n`}</code></pre>\n    <p>{`This event will be triggered in `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/magento/magento2/tree/2.4/app/code/Magento/Payment/Model/Method/Adapter.php\"\n      }}>{`Adapter::assignData()`}</a>{` method call:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`public function assignData(\\\\Magento\\\\Framework\\\\DataObject $data)\n{\n    $this->eventManager->dispatch(\n        'payment_method_assign_data_' . $this->getCode(),\n        [\n            AbstractDataAssignObserver::METHOD_CODE => $this,\n            AbstractDataAssignObserver::MODEL_CODE => $this->getInfoInstance(),\n            AbstractDataAssignObserver::DATA_CODE => $data\n        ]\n    );\n\n    $this->eventManager->dispatch(\n        'payment_method_assign_data',\n        [\n            AbstractDataAssignObserver::METHOD_CODE => $this,\n            AbstractDataAssignObserver::MODEL_CODE => $this->getInfoInstance(),\n            AbstractDataAssignObserver::DATA_CODE => $data\n        ]\n    );\n\n    return $this;\n}\n`}</code></pre>\n    <p>{`There are two events:`}</p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`payment_method_assign_data_payment_code`}</inlineCode>{`: specific for current method (placing order using this payment method)`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><inlineCode parentName=\"p\">{`payment_method_assign_data`}</inlineCode>{`: global for all payments (place order)`}</p>\n      </li>\n    </ul>\n    <p>{`What type of event to use depends on your implementation, but in most cases it will be enough to use the event for current payment method.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["name","_frontmatter","InlineAlert","props","console","warn","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","variant","slots","isMDXComponent"],"sourceRoot":""}