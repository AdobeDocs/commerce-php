"use strict";(self.webpackChunkcommerce_php=self.webpackChunkcommerce_php||[]).push([[44539],{58662:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return p},default:function(){return c}});var a=t(87462),i=t(63366),o=(t(15007),t(64983)),m=t(91515),r=t(1930),l=["components"],p={},d={_frontmatter:p},s=m.Z;function c(e){var n=e.components,t=(0,i.Z)(e,l);return(0,o.mdx)(s,(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)(r.default,{mdxType:"Docs"}),(0,o.mdx)("h1",{id:"vault-implementation-for-admin"},"Vault implementation for Admin"),(0,o.mdx)("p",null,"To be able to use vault in Admin order creation, you need to take at least the following steps:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Create a token component provider and specify it in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"<your_module_dir>/etc/di.xml"),".")),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Create a custom vault JS component and specify it in the component provider.")),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Create a ",(0,o.mdx)("inlineCode",{parentName:"p"},".phtml")," template, specify it in the component provider and the corresponding layout file."))),(0,o.mdx)("p",null,"There are more details about these steps in the following sections."),(0,o.mdx)("h2",{id:"component-provider"},"Component provider"),(0,o.mdx)("p",null,(0,o.mdx)("a",{parentName:"p",href:"token-ui-component-provider.md#token-component-provider"},"Similar to the storefront vault implementation"),", create a token component provider and specify it in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"di.xml"),". The component provider must implement the ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/tree/2.4/app/code/Magento/Vault/Model/Ui/TokenUiComponentProviderInterface.php"},(0,o.mdx)("inlineCode",{parentName:"a"},"TokenUiComponentProviderInterface"))," interface."),(0,o.mdx)("p",null,"Following is an example of a component provider for Admin:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-php"},"class TokenUiComponentProvider implements TokenUiComponentProviderInterface\n{\n    /**\n     * @inheritdoc\n     */\n    public function getComponentForToken(PaymentTokenInterface $paymentToken)\n    {\n        $data = json_decode($paymentToken->getTokenDetails() ?: '{}', true);\n        $component = $this->componentFactory->create(\n            [\n                'config' => [\n                    'code' => ConfigProvider::CC_VAULT_CODE,\n                    'nonceUrl' => $this->getNonceRetrieveUrl(),\n                    TokenUiComponentProviderInterface::COMPONENT_DETAILS => $data,\n                    TokenUiComponentProviderInterface::COMPONENT_PUBLIC_HASH => $paymentToken->getPublicHash(),\n                    'template' => 'Magento_Braintree::form/vault.phtml'\n                ],\n                'name' => Template::class\n            ]\n        );\n\n        return $component;\n    }\n}\n")),(0,o.mdx)("h2",{id:"vault-js-component"},"Vault JS component"),(0,o.mdx)("p",null,"There is no default component implementation for the Admin, so your component must implement all logic for validation and order placing."),(0,o.mdx)("p",null,"In the most cases, it is enough to implement getting payment code and setting public hash. This implementation might look like following:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-javascript"},"define([\n    'jquery',\n    'uiComponent'\n], function ($, Class) {\n    'use strict';\n\n    return Class.extend({\n        defaults: {\n            $selector: null,\n            selector: 'edit_form'\n        },\n\n        initObservable: function () {\n            var self = this;\n\n            self.$selector = $('#' + self.selector);\n            this._super();\n\n            this.initEventHandlers();\n\n            return this;\n        },\n\n        getCode: function () {\n            return this.code;\n        },\n\n        initEventHandlers: function () {\n            $('#' + this.container).find('[name=\"payment[token_switcher]\"]')\n                .on('click', this.setPaymentDetails.bind(this));\n        },\n\n        setPaymentDetails: function () {\n            this.$selector.find('[name=\"payment[public_hash]\"]').val(this.publicHash);\n        }\n    });\n});\n")),(0,o.mdx)("p",null,"This component will set public hash to a hidden input, when a user sets payment token as active."),(0,o.mdx)("h2",{id:"template"},"Template"),(0,o.mdx)("p",null,"Create a ",(0,o.mdx)("inlineCode",{parentName:"p"},".phtml")," template for displaying token details and specify it in the ",(0,o.mdx)("a",{parentName:"p",href:"#component-provider"},"component provider"),"."),(0,o.mdx)("p",null,"For reference, view the Adobe Commerce default Vault template for Admin: ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/tree/2.4/app/code/Magento/Vault/view/adminhtml/templates/form/vault.phtml"},"app/code/Magento/Vault/view/adminhtml/templates/form/vault.phtml"),"."),(0,o.mdx)("p",null,"In the billing form block for Admin layout (",(0,o.mdx)("inlineCode",{parentName:"p"},"%module_dir%/view/adminhtml/layout/sales_order_create_index.xml"),")\nspecify the payment method code and path to the template."),(0,o.mdx)("p",null,"Following is an example of such layout:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-xml"},'<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd">\n    <body>\n        <referenceBlock name="order_create_billing_form">\n            <action method="setMethodFormTemplate">\n                <argument name="method" xsi:type="string">braintree_cc_vault</argument>\n                <argument name="template" xsi:type="string">Magento_Vault::form/vault.phtml</argument>\n            </action>\n        </referenceBlock>\n    </body>\n</page>\n')),(0,o.mdx)("p",null,"According to this configuration the Magento_Vault module will render vault payments and all depending JS components will be created."),(0,o.mdx)("h2",{id:"specific-vault-configuration-for-admin"},"Specific vault configuration for Admin"),(0,o.mdx)("p",null,"You might have specific request builders, response handlers or other entities for the Admin panel. For example, in your implementation 3D Secure might not be available in Admin. In this case, you need to create corresponding virtual types for the ",(0,o.mdx)("inlineCode",{parentName:"p"},"adminhtml")," ",(0,o.mdx)("a",{parentName:"p",href:"../../../architecture/modules/areas.md"},"area")," in ",(0,o.mdx)("inlineCode",{parentName:"p"},"%module_dir%/etc/adminhtml/di.xml"),"."),(0,o.mdx)("p",null,"Example from the ",(0,o.mdx)("inlineCode",{parentName:"p"},"app/code/Magento/Braintree/etc/adminhtml/di.xml"),":"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-xml"},'<virtualType name="BraintreeVaultAuthorizeRequest" type="Magento\\Payment\\Gateway\\Request\\BuilderComposite">\n    <arguments>\n        <argument name="builders" xsi:type="array">\n            <item name="customer" xsi:type="string">Magento\\Braintree\\Gateway\\Request\\CustomerDataBuilder</item>\n            <item name="payment" xsi:type="string">Magento\\Braintree\\Gateway\\Request\\PaymentDataBuilder</item>\n            <item name="channel" xsi:type="string">Magento\\Braintree\\Gateway\\Request\\ChannelDataBuilder</item>\n            <item name="address" xsi:type="string">Magento\\Braintree\\Gateway\\Request\\AddressDataBuilder</item>\n            <item name="3dsecure" xsi:type="string">Magento\\Braintree\\Gateway\\Request\\ThreeDSecureDataBuilder</item>\n            <item name="device_data" xsi:type="string">Magento\\Braintree\\Gateway\\Request\\KountPaymentDataBuilder</item>\n            <item name="dynamic_descriptor" xsi:type="string">Magento\\Braintree\\Gateway\\Request\\DescriptorDataBuilder</item>\n            <item name="store" xsi:type="string">Magento\\Braintree\\Gateway\\Request\\StoreConfigBuilder</item>\n            <item name="merchant_account" xsi:type="string">Magento\\Braintree\\Gateway\\Request\\MerchantAccountDataBuilder</item>\n        </argument>\n    </arguments>\n</virtualType>\n')),(0,o.mdx)("p",null,"This configuration will be applied only in Admin panel.\nFor more information about area-specific configuration see the ",(0,o.mdx)("a",{parentName:"p",href:"../base-integration/admin-integration.md"},"Configure payment method by area")," topic."))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-development-payments-integrations-vault-admin-integration-md-5a26c2f533aaf1110f92.js.map