{"version":3,"file":"component---src-pages-development-components-declarative-schema-patches-md-52afa8c5c84e6f2bf45c.js","mappings":"uMAUsBA,E,wEAFTC,EAAe,CAAC,EAOvBC,GALgBF,EAKY,cALJ,SAA6BG,GAEzD,OADAC,QAAQC,KAAK,aAAeL,EAAO,4EAC5B,eAASG,EACjB,GAGKG,EAAc,CAClBL,aAAAA,GAEIM,EAAYC,EAAAA,EACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGP,GACF,YACD,OAAO,SAACI,GAAD,UAAeD,EAAiBH,EAAhC,CAAuCO,WAAYA,EAAYC,QAAQ,eAG5E,eACE,GAAM,mCADR,oCAGA,+GAAgG,uBAAYC,WAAW,KAAvB,4DAAhG,yBAA6N,uBAAYA,WAAW,KAAvB,0DAA7N,MACA,8IAA+H,uBAAYA,WAAW,KAAvB,8DAA/H,yBAA8P,uBAAYA,WAAW,KAAvB,4DAA9P,MACA,4IAA6H,uBAAYA,WAAW,KAAvB,cAA7H,yEAA4P,uBAAYA,WAAW,KAAvB,iBAA5P,2BACA,sIAAuH,uBAAYA,WAAW,KAAvB,gEAAvH,MACA,mFAAoE,uBAAYA,WAAW,KAAvB,gBAApE,yJAAqR,uBAAYA,WAAW,KAAvB,gBAArR,cACA,iUACA,SAACV,EAAD,CAAaW,QAAQ,OAAOC,MAAM,OAAOH,QAAQ,iBACjD,sIAAuH,cAAGC,WAAW,IACjI,KAAQ,oBAD2G,iBAAvH,yCAGA,wEAAyD,uBAAYA,WAAW,KAAvB,4CAAzD,+HAEA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,oJASL,kGACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,m3FAyFL,eACE,GAAM,0BADR,2BAGA,oJAAqI,uBAAYA,WAAW,KAAvB,YAArI,kBAA2M,uBAAYA,WAAW,KAAvB,gBAA3M,sCAAyS,uBAAYA,WAAW,KAAvB,oBAAzS,cACA,8DAA+C,uBAAYA,WAAW,KAAvB,YAA/C,6BACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBADZ,sDAIL,8DAA+C,uBAAYA,WAAW,KAAvB,gBAA/C,6BACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBADZ,qEAIL,eACE,GAAM,2CADR,6CAGA,yJACQ,uBAAYA,WAAW,KAAvB,6DADR,sRAIH,CAEDH,EAAWM,gBAAiB,C","sources":["webpack://commerce-php/./src/pages/development/components/declarative-schema/patches.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst InlineAlert = makeShortcode(\"InlineAlert\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"develop-data-and-schema-patches\"\n    }}>{`Develop data and schema patches`}</h1>\n    <p>{`A data patch is a class that contains data modification instructions. It is defined in a `}<inlineCode parentName=\"p\">{`<Vendor>/<Module_Name>/Setup/Patch/Data/<Patch_Name>.php`}</inlineCode>{` file and implements `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\Setup\\\\Patch\\\\DataPatchInterface`}</inlineCode>{`.`}</p>\n    <p>{`A schema patch contains custom schema modification instructions. These modifications can be complex. It is defined in a `}<inlineCode parentName=\"p\">{`<Vendor>/<Module_Name>/Setup/Patch/Schema/<Patch_Name>.php`}</inlineCode>{` file and implements `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\Setup\\\\Patch\\\\SchemaPatchInterface`}</inlineCode>{`.`}</p>\n    <p>{`Unlike the declarative schema approach, patches will only be applied once. A list of applied patches is stored in the `}<inlineCode parentName=\"p\">{`patch_list`}</inlineCode>{` database table. An unapplied patch will be applied when running the `}<inlineCode parentName=\"p\">{`setup:upgrade`}</inlineCode>{` from the Magento CLI.`}</p>\n    <p>{`Optionally, if you plan to enable rollback for your patch during module uninstallation, then you must implement `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\Setup\\\\Patch\\\\PatchRevertableInterface`}</inlineCode>{`.`}</p>\n    <p>{`The declarative schema approach removes the version from the `}<inlineCode parentName=\"p\">{`setup_module`}</inlineCode>{` table (in a backward compatible way), leaving only the Composer version. Therefore, you can create all new patches and modules without specifying a `}<inlineCode parentName=\"p\">{`setup_module`}</inlineCode>{` version.`}</p>\n    <p>{`The sequence of installing patches is handled through a dependency-based approach. Patches can either be independent or dependent on other patches. Independent patches can be installed in any sequence. A dependent patch requires a minimal number of patches so that it can be installed successfully.`}</p>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`Adobe Commerce and Magento Open Source prioritize the declarative schema approach and executes updates from the `}<a parentName=\"p\" {...{\n        \"href\": \"configuration.md\"\n      }}>{`db_schema.xml`}</a>{` before the data and schema patches.`}</p>\n    <p>{`To define a dependency in a patch, add the method `}<inlineCode parentName=\"p\">{`public static function getDependencies()`}</inlineCode>{`\nto the patch class and return the class names of the patches this patch depends on. The dependency can be in any module.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`public static function getDependencies()\n{\n    return [\n        \\\\SomeVendor\\\\SomeModule\\\\Setup\\\\Patch\\\\Data\\\\SomePatch::class\n    ];\n}\n`}</code></pre>\n    <p>{`The following code sample defines a data patch class that has a dependency.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`<?php\n/**\n * Copyright Â© Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\nnamespace Magento\\\\DummyModule\\\\Setup\\\\Patch\\\\Data;\n\nuse Magento\\\\Framework\\\\Setup\\\\ModuleDataSetupInterface;\nuse Magento\\\\Framework\\\\Setup\\\\Patch\\\\DataPatchInterface;\nuse Magento\\\\Framework\\\\Setup\\\\Patch\\\\PatchRevertableInterface;\n\nclass DummyPatch\n    implements DataPatchInterface,\n    PatchRevertableInterface\n{\n    /**\n     * @var ModuleDataSetupInterface\n     */\n    private $moduleDataSetup;\n\n    /**\n     * @param ModuleDataSetupInterface $moduleDataSetup\n     */\n    public function __construct(\n        ModuleDataSetupInterface $moduleDataSetup\n    ) {\n        /**\n         * If before, we pass $setup as argument in install/upgrade function, from now we start\n         * inject it with DI. If you want to use setup, you can inject it, with the same way as here\n         */\n        $this->moduleDataSetup = $moduleDataSetup;\n    }\n\n    /**\n     * @inheritdoc\n     */\n    public function apply()\n    {\n        $this->moduleDataSetup->getConnection()->startSetup();\n        //The code that you want apply in the patch\n        //Please note, that one patch is responsible only for one setup version\n        //So one UpgradeData can consist of few data patches\n        $this->moduleDataSetup->getConnection()->endSetup();\n    }\n\n    /**\n     * @inheritdoc\n     */\n    public static function getDependencies()\n    {\n        /**\n         * This is dependency to another patch. Dependency should be applied first\n         * One patch can have few dependencies\n         * Patches do not have versions, so if in old approach with Install/Ugrade data scripts you used\n         * versions, right now you need to point from patch with higher version to patch with lower version\n         * But please, note, that some of your patches can be independent and can be installed in any sequence\n         * So use dependencies only if this important for you\n         */\n        return [\n            SomeDependency::class\n        ];\n    }\n\n    public function revert()\n    {\n        $this->moduleDataSetup->getConnection()->startSetup();\n        //Here should go code that will revert all operations from \\`apply\\` method\n        //Please note, that some operations, like removing data from column, that is in role of foreign key reference\n        //is dangerous, because it can trigger ON DELETE statement\n        $this->moduleDataSetup->getConnection()->endSetup();\n    }\n\n    /**\n     * @inheritdoc\n     */\n    public function getAliases()\n    {\n        /**\n         * This internal method, that means that some patches with time can change their names,\n         * but changing name should not affect installation process, that's why if we will change name of the patch\n         * we will add alias here\n         */\n        return [];\n    }\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"reverting-data-patches\"\n    }}>{`Reverting data patches`}</h2>\n    <p>{`Adobe Commerce and Magento Open Source do not allow you to revert a particular module data patch. However, you can revert all `}<inlineCode parentName=\"p\">{`composer`}</inlineCode>{` installed or `}<inlineCode parentName=\"p\">{`non-composer`}</inlineCode>{` installed data patches using the `}<inlineCode parentName=\"p\">{`module:uninstall`}</inlineCode>{` command.`}</p>\n    <p>{`Run the following command to revert all `}<inlineCode parentName=\"p\">{`composer`}</inlineCode>{` installed data patches:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`bin/magento module:uninstall Vendor_ModuleName\n`}</code></pre>\n    <p>{`Run the following command to revert all `}<inlineCode parentName=\"p\">{`non-composer`}</inlineCode>{` installed data patches:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`bin/magento module:uninstall --non-composer Vendor_ModuleName\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"will-old-scripts-work-in-newer-versions\"\n    }}>{`Will old scripts work in newer versions?`}</h2>\n    <p>{`Old scripts will work with new versions of Magento. However, if you want to convert your old scripts to the new format,\nimplement `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\Setup\\\\Patch\\\\PatchVersionInterface`}</inlineCode>{`. This interface allows you to specify the setup version of the module in your database. If the version of the module is higher than or equal to the version specified in your patch, then the patch is skipped. If the version in the database is lower, then the patch installs.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["name","_frontmatter","InlineAlert","props","console","warn","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","variant","slots","isMDXComponent"],"sourceRoot":""}