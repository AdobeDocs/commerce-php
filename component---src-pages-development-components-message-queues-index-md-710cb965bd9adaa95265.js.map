{"version":3,"file":"component---src-pages-development-components-message-queues-index-md-710cb965bd9adaa95265.js","mappings":"oRAQaA,EAAe,CAAC,EACvBC,EAAc,CAClBD,gBAEIE,EAAYC,EAAAA,EACH,SAASC,EAAT,GAGZ,IAHgC,WACjCC,GAEC,EADEC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,eACE,GAAM,kBACH,mBACL,kBAAK,uTACL,kBAAK,mPAAiP,cAAGC,WAAW,IAChQ,KAAQ,2BACL,YAAgB,2PACvB,kBAAK,oKAAkK,uBAAYA,WAAW,KAAM,SAAsB,MAAI,uBAAYA,WAAW,KAAM,iBAA8B,UAAQ,uBAAYA,WAAW,KAAM,wBAAqC,qLACnW,kBAAK,QAAM,cAAGA,WAAW,IACrB,KAAQ,oBACL,4BAAgC,gEACvC,eACE,GAAM,gDACH,iDACL,kBAAK,yDAAuD,uBAAYA,WAAW,KAAM,WAAwB,0BAAwB,uBAAYA,WAAW,KAAM,wBACtK,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBACV,6CAEP,kBAAK,8GAA4G,uBAAYA,WAAW,KAAM,iBAA8B,6BAA2B,uBAAYA,WAAW,KAAM,wBAAqC,yCAAuC,uBAAYA,WAAW,KAAM,SAAsB,MAAI,uBAAYA,WAAW,KAAM,iBAA8B,UAAQ,uBAAYA,WAAW,KAAM,wBAAqC,0BAC5e,eACE,GAAM,0BACH,2BACL,kBAAK,+GACL,eACE,GAAM,YACH,aACL,kBAAK,sDAAoD,cAAGA,WAAW,IACnE,KAAQ,uCACP,uBAAYA,WAAW,KAAM,uBAAuC,yBAAuB,uBAAYA,WAAW,KAAM,6BAA0C,wFAAsF,uBAAYA,WAAW,KAAM,oDAC1R,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBACV,kFAGP,eACE,GAAM,iBACH,kBACL,kBAAK,cAAY,uBAAYA,WAAW,KAAM,wFAAqG,gCACnJ,kBAAK,mCACL,oBACE,eAAIA,WAAW,MAAO,iEAA+D,uBAAYA,WAAW,MAAO,oFAAiG,MACpN,eAAIA,WAAW,MAAO,WAAS,uBAAYA,WAAW,MAAO,wBAAqC,uCAAqC,uBAAYA,WAAW,MAAO,cAA2B,wKAChM,eAAIA,WAAW,MAAO,uDAAqD,uBAAYA,WAAW,MAAO,sEAAmF,MAC5L,eAAIA,WAAW,MAAO,oBAAkB,uBAAYA,WAAW,MAAO,iFAA8F,gDAEtK,eACE,GAAM,2CACH,4CACL,kBAAK,iHACL,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBACV,k1BAiCV,CAEDJ,EAAWK,gBAAiB,C","sources":["webpack://commerce-php/./src/pages/development/components/message-queues/index.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"message-queues\"\n    }}>{`Message queues`}</h1>\n    <p>{`Message queues provide an asynchronous communications mechanism in which the sender and the receiver of a message do not contact each other, nor do they need to communicate with the message queue at the same time. When a sender places a message onto a queue, it is stored until the recipient receives them.`}</p>\n    <p>{`In Adobe Commerce and Magento Open Source, the Message Queue Framework (MQF) is a fully-functional system that allows a module to publish messages to queues. It also creates consumers to receive them asynchronously. The MQF primarily uses `}<a parentName=\"p\" {...{\n        \"href\": \"http://www.rabbitmq.com\"\n      }}>{`RabbitMQ`}</a>{` as the messaging broker, which provides a scalable platform for sending and receiving messages. It also includes a mechanism for storing undelivered messages. RabbitMQ is based on the Advanced Message Queuing Protocol (AMQP) 0.9.1 specification.`}</p>\n    <p>{`A basic message queue system can also be set up without using RabbitMQ. In this system, a MySQL adapter stores messages in the database. Three database tables (`}<inlineCode parentName=\"p\">{`queue`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`queue_message`}</inlineCode>{`, and `}<inlineCode parentName=\"p\">{`queue_message_status`}</inlineCode>{`) manage the message queue workload. Cron jobs ensure the consumers are able to receive messages. This solution is not very scalable. RabbitMQ should be used whenever possible.`}</p>\n    <p>{`See `}<a parentName=\"p\" {...{\n        \"href\": \"configuration.md\"\n      }}>{`Configure message queues`}</a>{` for information about setting up the message queue system.`}</p>\n    <h2 {...{\n      \"id\": \"send-a-message-from-the-publisher-to-a-queue\"\n    }}>{`Send a message from the publisher to a queue`}</h2>\n    <p>{`The following code sends a message to the queue. The `}<inlineCode parentName=\"p\">{`publish`}</inlineCode>{` method is defined in `}<inlineCode parentName=\"p\">{`PublisherInterface`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`$publisher->publish($topic, $message)\n`}</code></pre>\n    <p>{`In a MySQL adapter environment, a message that is published to multiple queues creates a single record in `}<inlineCode parentName=\"p\">{`queue_message`}</inlineCode>{` and multiple records in `}<inlineCode parentName=\"p\">{`queue_message_status`}</inlineCode>{`: one for each queue. (A join on the `}<inlineCode parentName=\"p\">{`queue`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`queue_message`}</inlineCode>{`, and `}<inlineCode parentName=\"p\">{`queue_message_status`}</inlineCode>{` tables is required).`}</p>\n    <h2 {...{\n      \"id\": \"instantiate-a-consumer\"\n    }}>{`Instantiate a consumer`}</h2>\n    <p>{`The procedure for instantiating a consumer differs, depending on which message queue system is being used.`}</p>\n    <h3 {...{\n      \"id\": \"rabbitmq\"\n    }}>{`RabbitMQ`}</h3>\n    <p>{`This instantiates a consumer that is defined in a `}<a parentName=\"p\" {...{\n        \"href\": \"configuration.md#queue_consumerxml\"\n      }}><inlineCode parentName=\"a\">{`queue_consumer.xml`}</inlineCode></a>{` file. The consumer (`}<inlineCode parentName=\"p\">{`customer_created_listener`}</inlineCode>{`) listens to the queue and receives all new messages. For every message, it invokes `}<inlineCode parentName=\"p\">{`Magento\\\\Some\\\\Class::processMessage($message)`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`$this->consumerFactory->get('customer_created_listener')\n    ->process();\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"mysql-adapter\"\n    }}>{`MySQL adapter`}</h3>\n    <p>{`Implement `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Framework\\\\MessageQueue\\\\ConsumerInterface::process($maxNumberOfMessages)`}</inlineCode>{` to instantiate a consumer.`}</p>\n    <p>{`Perform the following actions:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Define the queue name associated with current consumer using `}<inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\MessageQueue\\\\ConsumerConfigurationInterface::getQueueName`}</inlineCode>{`.`}</li>\n      <li parentName=\"ol\">{`Select `}<inlineCode parentName=\"li\">{`$maxNumberOfMessages`}</inlineCode>{` message records, filtering on the `}<inlineCode parentName=\"li\">{`queue_name`}</inlineCode>{` field. You must join on all 3 tables. To accomplish this, you may want to extract fewer records at a time to improve load distribution between multiple consumers.`}</li>\n      <li parentName=\"ol\">{`Decode the message using topic name taken from the `}<inlineCode parentName=\"li\">{`\\\\Magento\\\\Framework\\\\MessageQueue\\\\ConsumerConfigurationInterface`}</inlineCode>{`.`}</li>\n      <li parentName=\"ol\">{`Invoke callback `}<inlineCode parentName=\"li\">{`Magento\\\\Framework\\\\MessageQueue\\\\ConsumerConfigurationInterface::getCallback`}</inlineCode>{` and pass the decoded data as an argument.`}</li>\n    </ol>\n    <h2 {...{\n      \"id\": \"change-message-queue-from-mysql-to-amqp\"\n    }}>{`Change message queue from MySQL to AMQP`}</h2>\n    <p>{`The following sample introduces a runtime configuration that allows you to redefine the adapter for a topic.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`'queue' => [\n    'topics' => [\n        'product_action_attribute.update' => [\n            'publisher' => 'amqp-magento'\n        ]\n    ],\n    'config' => [\n        'publishers' => [\n            'product_action_attribute.update' => [\n                'connections' => [\n                    'amqp' => [\n                        'name' => 'amqp',\n                        'exchange' => 'magento',\n                        'disabled' => false\n                    ],\n                    'db' => [\n                        'name' => 'db',\n                        'exchange' => 'magento',\n                        'disabled' => true\n                    ]\n                ]\n            ]\n        ]\n    ],\n    'consumers' => [\n        'product_action_attribute.update' => [\n            'connection' => 'amqp',\n        ],\n    ],\n],\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}