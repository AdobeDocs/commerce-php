"use strict";(self.webpackChunkcommerce_php=self.webpackChunkcommerce_php||[]).push([[2880],{69054:function(e,n,a){a.r(n),a.d(n,{_frontmatter:function(){return p},default:function(){return u}});var t,o=a(87462),l=a(63366),r=(a(15007),a(64983)),i=a(91515),m=["components"],p={},d=(t="InlineAlert",function(e){return console.warn("Component "+t+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.mdx)("div",e)}),s={_frontmatter:p},c=i.Z;function u(e){var n=e.components,a=(0,l.Z)(e,m);return(0,r.mdx)(c,(0,o.Z)({},s,a,{components:n,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,"A view model is an abstraction of the view exposing public properties and commands. It allows developers to offload features and business logic from block classes into separate classes that are easier to maintain, test, and reuse."),(0,r.mdx)("h2",{id:"when-to-use-view-models"},"When to use view models"),(0,r.mdx)("p",null,"Use this approach anytime you need to inject functionality into template files and your code does not need to be backwards compatible with Magento."),(0,r.mdx)(d,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"View models are available in Adobe Commerce and Magento Open Source 2.2 and later. If your code must be compatible with older versions of Magento, consider adding your logic to blocks. For more information, see ",(0,r.mdx)("a",{parentName:"p",href:"https://developer.adobe.com/commerce/contributor/guides/code-contributions/backward-compatibility-policy/"},"Backward compatibility"),"."),(0,r.mdx)(d,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"The use of helpers in templates is discouraged. It is recommended to use view models instead."),(0,r.mdx)("h2",{id:"how-to-write-view-models"},"How to write view models"),(0,r.mdx)("p",null,"View models can be used by passing the view model class as an argument to a template's block in the page layout configuration file. In the following example snippet, ",(0,r.mdx)("inlineCode",{parentName:"p"},"MyNewViewModel")," is the view model class of the ExampleCorp_Catalog module passed as an argument to a block."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-xml"},'<block name="examplecorp.new.viewmodel" template="ExampleCorp_Catalog::example.phtml">\n    <arguments>\n        <argument name="view_model" xsi:type="object">ExampleCorp\\Catalog\\ViewModel\\MyNewViewModel</argument>\n    </arguments>\n</block>\n')),(0,r.mdx)("p",null,"In the following example, the same view model is used with an existing block in ",(0,r.mdx)("inlineCode",{parentName:"p"},"Magento/Checkout/view/frontend/layout/checkout_cart_item_renderers.xml"),"."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-xml"},'<referenceBlock name="checkout.cart.item.renderers.default">\n    <arguments>\n        <argument name="view_model" xsi:type="object">ExampleCorp\\Catalog\\ViewModel\\MyNewViewModel</argument>\n    </arguments>\n</referenceBlock>\n')),(0,r.mdx)("p",null,"The view model class must always implement the interface ",(0,r.mdx)("inlineCode",{parentName:"p"},"\\Magento\\Framework\\View\\Element\\Block\\ArgumentInterface"),". For example:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"namespace ExampleCorp\\Catalog\\ViewModel;\n\nclass MyNewViewModel implements \\Magento\\Framework\\View\\Element\\Block\\ArgumentInterface\n{\n    public function getTitle()\n    {\n      return 'Hello World';\n    }\n}\n")),(0,r.mdx)("p",null,"You can access the public methods for the view model class in the template:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-html"},"<?php\n\n/** @var $viewModel \\ExampleCorp\\Catalog\\ViewModel\\MyNewViewModel */\n\n$viewModel = $block->getViewModel();\n\n?>\n<h1><?= $block->escapeHtml($viewModel->getTitle()); ?></h1>\n")),(0,r.mdx)("h2",{id:"examples-of-view-models"},"Examples of view models"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("a",{parentName:"li",href:"https://github.com/magento/magento2/blob/2.3.3/app/code/Magento/Theme/view/frontend/layout/default.xml#L43-L45",title:"view_model definition"},"Theme"),". This ",(0,r.mdx)("inlineCode",{parentName:"li"},"view_model")," is injected into a template to return the target store redirect url.")),(0,r.mdx)("p",null,"The following is an example of view model usage within the ",(0,r.mdx)("inlineCode",{parentName:"p"},"Magento/Catalog/view/frontend/layout/catalog_product_view.xml")," layout file."),(0,r.mdx)("p",null,"The view model class is passed as an argument to the ",(0,r.mdx)("inlineCode",{parentName:"p"},"product.info.upsell")," block in the layout configuration file:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-xml"},'<block class="Magento\\Catalog\\Block\\Product\\ProductList\\Upsell" name="product.info.upsell" template="Magento_Catalog::product/list/items.phtml">\n    <arguments>\n        <argument name="type" xsi:type="string">upsell</argument>\n        <argument name="view_model" xsi:type="object">Magento\\Catalog\\ViewModel\\Product\\Listing\\PreparePostData</argument>\n    </arguments>\n</block>\n')),(0,r.mdx)("p",null,"The following is an example of the view model class ",(0,r.mdx)("inlineCode",{parentName:"p"},"Magento/Catalog/ViewModel/Product/Listing/PreparePostData.php")," implementation in the catalog module."),(0,r.mdx)("p",null,"The class must implement the ",(0,r.mdx)("inlineCode",{parentName:"p"},"\\Magento\\Framework\\View\\Element\\Block\\ArgumentInterface")," interface class."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"namespace Magento\\Catalog\\ViewModel\\Product\\Listing;\n\nuse Magento\\Framework\\View\\Element\\Block\\ArgumentInterface;\nuse Magento\\Framework\\App\\ActionInterface;\nuse Magento\\Framework\\Url\\Helper\\Data as UrlHelper;\n\n/**\n * Check is available add to compare.\n */\nclass PreparePostData implements ArgumentInterface\n{\n    /**\n     * @var UrlHelper\n     */\n    private $urlHelper;\n\n    /**\n     * @param UrlHelper $urlHelper\n     */\n    public function __construct(UrlHelper $urlHelper)\n    {\n        $this->urlHelper = $urlHelper;\n    }\n\n    /**\n     * Wrapper for the PostHelper::getPostData()\n     *\n     * @param string $url\n     * @param array $data\n     * @return array\n     */\n    public function getPostData(string $url, array $data = []):array\n    {\n        if (!isset($data[ActionInterface::PARAM_NAME_URL_ENCODED])) {\n            $data[ActionInterface::PARAM_NAME_URL_ENCODED] = $this->urlHelper->getEncodedUrl();\n        }\n        return ['action' => $url, 'data' => $data];\n    }\n}\n")),(0,r.mdx)("p",null,"The following is an example of the view model initialization in the ",(0,r.mdx)("inlineCode",{parentName:"p"},"app/code/Magento/Catalog/view/frontend/templates/product/list/items.phtml")," template."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-php"},"/** @var $viewModel /Magento/Catalog/ViewModel/Product/Listing/PreparePostData */\n$viewModel = $block->getViewModel();\n$postArray = $viewModel->getPostData(\n    $block->escapeUrl($block->getAddToCartUrl($_item)),\n    ['product' => $_item->getEntityId()]\n);\n")))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-developer-components-view-models-md-313c7ae4abc04d7f0165.js.map