{"version":3,"file":"component---src-pages-developer-components-price-adjustments-md-d84bf6e214cb75bf0564.js","mappings":"8QAQaA,EAAe,GACtBC,EAAc,CAClBD,aAAAA,GAEIE,EAAYC,EAAAA,EACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,kHACA,mDAAoC,uBAAYC,WAAW,KAAvB,QAApC,4BACA,2FAA4E,uBAAYA,WAAW,KAAvB,4BAA5E,MACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,yqBAoBL,0BAAW,uBAAYA,WAAW,KAAvB,wCAAX,4BACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,yhEA2FL,0BAAW,uBAAYA,WAAW,KAAvB,mBAAX,6EAAmJ,uBAAYA,WAAW,KAAvB,uDAAnJ,iBACA,yDAA0C,uBAAYA,WAAW,KAAvB,qBAA1C,SAAgH,uBAAYA,WAAW,KAAvB,mBAAhH,gBACA,0EACA,wCAAyB,mBAAQA,WAAW,KAAnB,YAAzB,0HACA,eACE,GAAM,yCADR,0CAGA,4FACA,2CAA4B,uBAAYA,WAAW,KAAvB,+BAA5B,MACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,sYAWL,8BAAe,uBAAYA,WAAW,KAAvB,2CAAf,MACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,+oFAoGL,0BAAW,uBAAYA,WAAW,KAAvB,uBAAX,4EAAsJ,uBAAYA,WAAW,KAAvB,gEAAtJ,mBAAiR,uBAAYA,WAAW,KAAvB,gEAAjR,MACA,eACE,GAAM,kDADR,mDAGA,2GACA,gDACA,mBAAG,uBAAYA,WAAW,KAAvB,8DAAH,MACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,8sCA0BL,oDAAqC,uBAAYA,WAAW,KAAvB,+CAArC,MACA,mBAAG,uBAAYA,WAAW,KAAvB,oEAAH,MACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,uBADZ,ywCAuDL,+CAAgC,uBAAYA,WAAW,KAAvB,mCAAhC,MACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBADZ,sVAaL,eACE,GAAM,qDADR,sDAGA,8FAA+E,uBAAYA,WAAW,KAAvB,UAA/E,gBACA,mBAAG,uBAAYA,WAAW,KAAvB,+DAAH,MACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBADZ,2mEAsCL,0BAAW,uBAAYA,WAAW,KAAvB,+CAAX,mDACA,4HAKJJ,EAAWK,gBAAiB","sources":["webpack://commerce-php/./src/pages/developer/components/price-adjustments.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <p>{`Price Adjustments adjust the product price as it is displayed on category or product pages.`}</p>\n    <p>{`In this example, we will add `}<inlineCode parentName=\"p\">{`1.79`}</inlineCode>{` to each product price.`}</p>\n    <p>{`To create a price adjustment, add the following code to the module's `}<inlineCode parentName=\"p\">{`VENDOR/MODULE/etc/di.xml`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<type name=\"Magento\\\\Framework\\\\Pricing\\\\Adjustment\\\\Collection\">\n  <arguments>\n    <argument name=\"adjustments\" xsi:type=\"array\">\n      <item name=\"devadj\" xsi:type=\"const\">VENDOR\\\\MODULE\\\\Pricing\\\\Adjustment::ADJUSTMENT_CODE</item>\n    </argument>\n  </arguments>\n</type>\n<type name=\"Magento\\\\Framework\\\\Pricing\\\\Adjustment\\\\Pool\">\n  <arguments>\n     <argument name=\"adjustments\" xsi:type=\"array\">\n        <item name=\"devadj\" xsi:type=\"array\">\n           <item name=\"className\" xsi:type=\"string\">VENDOR\\\\MODULE\\\\Pricing\\\\Adjustment</item>\n           <item name=\"sortOrder\" xsi:type=\"string\">10</item>\n        </item>\n     </argument>\n  </arguments>\n</type>\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`VENDOR/MODULE/Pricing/Adjustment.php`}</inlineCode>{` file should look like:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`namespace VENDOR\\\\MODULE\\\\Pricing;\n\nuse Magento\\\\Framework\\\\Pricing\\\\Adjustment\\\\AdjustmentInterface;\nuse Magento\\\\Framework\\\\Pricing\\\\SaleableInterface;\n\nclass Adjustment implements AdjustmentInterface\n{\n\n    const ADJUSTMENT_CODE = 'devadj';\n    const ADJUSTMENT_VALUE = 1.79;\n\n    /**\n     * Get adjustment code\n     *\n     * @return string\n     */\n    public function getAdjustmentCode()\n    {\n        return self::ADJUSTMENT_CODE;\n    }\n\n    /**\n     * Define if adjustment is included in base price\n     *\n     * @return bool\n     */\n    public function isIncludedInBasePrice()\n    {\n        return true;\n    }\n\n    /**\n     * Define if adjustment is included in display price\n     *\n     * @return bool\n     */\n    public function isIncludedInDisplayPrice()\n    {\n        return true;\n    }\n\n    /**\n     * Extract adjustment amount from the given amount value\n     *\n     * @param float $amount\n     * @param SaleableInterface $saleableItem\n     * @param null|array $context\n     * @return float\n     */\n    public function extractAdjustment($amount, SaleableInterface $saleableItem, $context = [])\n    {\n        return $amount - self::ADJUSTMENT_VALUE;\n    }\n\n    /**\n     * Apply adjustment amount and return result value\n     *\n     * @param float $amount\n     * @param SaleableInterface $saleableItem\n     * @param null|array $context\n     * @return float\n     */\n    public function applyAdjustment($amount, SaleableInterface $saleableItem, $context = [])\n    {\n        return $amount + self::ADJUSTMENT_VALUE;\n    }\n\n    /**\n     * Check if adjustment should be excluded from calculations along with the given adjustment\n     *\n     * @param string $adjustmentCode\n     * @return bool\n     */\n    public function isExcludedWith($adjustmentCode)\n    {\n        return $this->getAdjustmentCode() === $adjustmentCode;\n    }\n\n    /**\n     * Return sort order position\n     *\n     * @return int\n     */\n    public function getSortOrder()\n    {\n        return 21;\n    }\n}\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`ADJUSTMENT_CODE`}</inlineCode>{` constant is a unique code for the adjustment which it gets added to the `}<inlineCode parentName=\"p\">{`Magento\\\\Framework\\\\Pricing\\\\Adjustment\\\\Collection`}</inlineCode>{` collection.`}</p>\n    <p>{`The adjustment logic is defined in `}<inlineCode parentName=\"p\">{`extractAdjustment`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`applyAdjustment`}</inlineCode>{` functions.`}</p>\n    <p>{`Price adjustments affect storefront product prices.`}</p>\n    <p>{`Price adjustments `}<strong parentName=\"p\">{`will not`}</strong>{` affect quote item prices, so when a product is added to the cart, any price adjustments defined above are discarded.`}</p>\n    <h2 {...{\n      \"id\": \"add-price-adjustments-for-quote-items\"\n    }}>{`Add price adjustments for quote items`}</h2>\n    <p>{`To adjustments prices for quote items, a custom quote total is added:`}</p>\n    <p>{`Add the following to `}<inlineCode parentName=\"p\">{`VENDOR/MODULE/etc/sales.xml`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<?xml version=\"1.0\"?>\n<config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"urn:magento:module:Magento_Sales:etc/sales.xsd\">\n    <section name=\"quote\">\n        <group name=\"totals\">\n            <item name=\"custom-surcharge\" instance=\"VENDOR\\\\MODULE\\\\Model\\\\Quote\\\\Surcharge\" sort_order=\"1000\"/>\n        </group>\n    </section>\n</config>\n`}</code></pre>\n    <p>{`Then in `}<inlineCode parentName=\"p\">{`VENDOR/MODULE/Model/Quote/Surcharge.php`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`namespace VENDOR\\\\MODULE\\\\Model\\\\Quote;\n\nuse Magento\\\\Quote\\\\Api\\\\Data\\\\ShippingAssignmentInterface;\nuse Magento\\\\Quote\\\\Model\\\\Quote\\\\Address\\\\Total;\nuse Magento\\\\Quote\\\\Model\\\\Quote;\n\nclass Surcharge extends \\\\Magento\\\\Quote\\\\Model\\\\Quote\\\\Address\\\\Total\\\\AbstractTotal\n{\n\n   const COLLECTOR_TYPE_CODE = 'custom-surcharge';\n\n   /**\n    * Custom constructor.\n    */\n   public function __construct()\n   {\n       $this->setCode(self::COLLECTOR_TYPE_CODE);\n   }\n\n   /**\n    * Collect address discount amount\n    *\n    * @param Quote $quote\n    * @param ShippingAssignmentInterface $shippingAssignment\n    * @param Total $total\n    * @return $this\n    */\n   public function collect(\n        Quote $quote,\n        ShippingAssignmentInterface $shippingAssignment,\n        Total $total\n   ) {\n        parent::collect($quote, $shippingAssignment, $total);\n\n        $items = $shippingAssignment->getItems();\n        if (!count($items)) {\n            return $this;\n        }\n\n        $amount = 0;\n        foreach($quote->getItemsCollection() as $_quoteItem){\n            $amount += $_quoteItem->getQty() * \\\\VENDOR\\\\MODULE\\\\Pricing\\\\Adjustment::ADJUSTMENT_VALUE;\n        }\n\n        $total->setTotalAmount(self::COLLECTOR_TYPE_CODE, $amount);\n        $total->setBaseTotalAmount(self::COLLECTOR_TYPE_CODE, $amount);\n        $total->setCustomAmount($amount);\n        $total->setBaseCustomAmount($amount);\n        $total->setGrandTotal($total->getGrandTotal() + $amount);\n        $total->setBaseGrandTotal($total->getBaseGrandTotal() + $amount);\n        return $this;\n   }\n\n  /**\n    * @param Total $total\n    */\n   protected function clearValues(Total $total)\n   {\n       $total->setTotalAmount('subtotal', 0);\n       $total->setBaseTotalAmount('subtotal', 0);\n       $total->setTotalAmount(self::COLLECTOR_TYPE_CODE, 0);\n       $total->setBaseTotalAmount(self::COLLECTOR_TYPE_CODE, 0);\n       $total->setSubtotalInclTax(0);\n       $total->setBaseSubtotalInclTax(0);\n   }\n\n   /**\n    * @param Quote $quote\n    * @param Total $total\n    * @return array\n    */\n   public function fetch(\n       Quote $quote,\n       Total $total\n   ) {\n\n       $amount = 0;\n\n       foreach ($quote->getItemsCollection() as $_quoteItem) {\n            $amount += $_quoteItem->getQty() * \\\\VENDOR\\\\MODULE\\\\Pricing\\\\Adjustment::ADJUSTMENT_VALUE;\n       }\n\n       return [\n           'code' => $this->getCode(),\n           'title' => __('Custom Total'),\n           'value' => $amount\n       ];\n   }\n\n   /**\n    * @return \\\\Magento\\\\Framework\\\\Phrase\n    */\n   public function getLabel()\n   {\n       return __('Custom Surchange');\n   }\n}\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`COLLECTOR_TYPE_CODE`}</inlineCode>{` constant is a unique name of the custom total. It can be accessed with `}<inlineCode parentName=\"p\">{`Magento\\\\Quote\\\\Model\\\\Quote\\\\Address\\\\Total::getTotalAmount`}</inlineCode>{`, and set with `}<inlineCode parentName=\"p\">{`Magento\\\\Quote\\\\Model\\\\Quote\\\\Address\\\\Total::setTotalAmount`}</inlineCode>{`.`}</p>\n    <h3 {...{\n      \"id\": \"display-price-adjusted-totals-on-the-cart-page\"\n    }}>{`Display price-adjusted totals on the cart page`}</h3>\n    <p>{`To display the price-adjusted total on the cart page, we need to create a few files.`}</p>\n    <p>{`First, add the new total:`}</p>\n    <p><inlineCode parentName=\"p\">{`VENDOR/MODULE/view/frontend/layout/checkout_cart_index.xml`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<?xml version=\"1.0\"?>\n<page xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"urn:magento:framework:View/Layout/etc/page_configuration.xsd\">\n    <body>\n        <referenceBlock name=\"checkout.cart.totals\">\n            <arguments>\n                <argument name=\"jsLayout\" xsi:type=\"array\">\n                    <item name=\"components\" xsi:type=\"array\">\n                        <item name=\"block-totals\" xsi:type=\"array\">\n                            <item name=\"children\" xsi:type=\"array\">\n                                <item name=\"custom-surcharge\" xsi:type=\"array\">\n                                    <item name=\"component\" xsi:type=\"string\">VENDOR_MODULE/js/view/cart/totals/surcharge</item>\n                                    <item name=\"config\" xsi:type=\"array\">\n                                        <item name=\"title\" xsi:type=\"string\" translate=\"true\">Custom Surcharge</item>\n                                    </item>\n                                </item>\n                            </item>\n                        </item>\n                    </item>\n                </argument>\n            </arguments>\n        </referenceBlock>\n    </body>\n</page>\n`}</code></pre>\n    <p>{`Then, define a new component: `}<inlineCode parentName=\"p\">{`VENDOR_MODULE/js/view/cart/totals/surcharge`}</inlineCode>{`:`}</p>\n    <p><inlineCode parentName=\"p\">{`VENDOR/MODULE/view/frontend/web/js/view/cart/totals/surcharge.js`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`define([\n    'Magento_Checkout/js/view/summary/abstract-total',\n    'Magento_Checkout/js/model/quote'\n], function (Component, quote) {\n    'use strict';\n\n    return Component.extend({\n        defaults: {\n            template: 'VENDOR_MODULE/summary/surcharge'\n        },\n        totals: quote.getTotals(),\n\n        /**\n         * @return {*|Boolean}\n         */\n        isDisplayed: function () {\n            return this.isFullMode() && this.getPureValue() != 0;\n        },\n\n        /**\n         * Get surcharge title\n         *\n         * @returns {null|String}\n         */\n        getTitle: function () {\n            if (!this.totals()) {\n                return null;\n            }\n\n            return 'Custom Surcharge';\n        },\n\n        /**\n         * @return {Number}\n         */\n        getPureValue: function () {\n            var price = 0;\n            for (var i=0; i < window.checkoutConfig.quoteItemData.length; i++) {\n              price += window.checkoutConfig.quoteItemData[i].qty * 1.79;\n            }\n\n            return price;\n        },\n\n        /**\n         * @return {*|String}\n         */\n        getValue: function () {\n            return this.getFormattedPrice(this.getPureValue());\n        }\n    });\n});\n`}</code></pre>\n    <p>{`Then create the template `}<inlineCode parentName=\"p\">{`VENDOR_MODULE/summary/surcharge`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-html\"\n      }}>{`<!-- ko if: isDisplayed() -->\n<tr class=\"totals surcharge\">\n    <th class=\"mark\" scope=\"row\">\n        <span class=\"title\" data-bind=\"text: getTitle()\"></span>\n    </th>\n    <td class=\"amount\">\n        <span class=\"price\" data-bind=\"text: getValue(), attr: {'data-th': name}\"></span>\n    </td>\n</tr>\n<!-- /ko -->\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"display-price-adjusted-total-on-the-checkout-page\"\n    }}>{`Display price-adjusted total on the checkout page`}</h3>\n    <p>{`To display the price-adjusted total on the checkout page, add it to the `}<inlineCode parentName=\"p\">{`totals`}</inlineCode>{` component.`}</p>\n    <p><inlineCode parentName=\"p\">{`VENDOR/MODULE/view/frontend/layout/checkout_index_index.xml`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<?xml version=\"1.0\"?>\n<page xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"urn:magento:framework:View/Layout/etc/page_configuration.xsd\">\n    <body>\n        <referenceBlock name=\"checkout.root\">\n            <arguments>\n                <argument name=\"jsLayout\" xsi:type=\"array\">\n                    <item name=\"components\" xsi:type=\"array\">\n                        <item name=\"checkout\" xsi:type=\"array\">\n                            <item name=\"children\" xsi:type=\"array\">\n                                <item name=\"sidebar\" xsi:type=\"array\">\n                                    <item name=\"children\" xsi:type=\"array\">\n                                        <item name=\"summary\" xsi:type=\"array\">\n                                            <item name=\"children\" xsi:type=\"array\">\n                                                <item name=\"totals\" xsi:type=\"array\">\n                                                    <item name=\"children\" xsi:type=\"array\">\n                                                        <item name=\"discount\" xsi:type=\"array\">\n                                                            <item name=\"component\" xsi:type=\"string\">VENDOR_MODULE/js/view/cart/totals/surcharge</item>\n                                                            <item name=\"config\" xsi:type=\"array\">\n                                                                <item name=\"title\" xsi:type=\"string\" translate=\"true\">Custom Surcharge</item>\n                                                            </item>\n                                                        </item>\n                                                    </item>\n                                                </item>\n                                            </item>\n                                        </item>\n                                    </item>\n                                </item>\n                            </item>\n                        </item>\n                    </item>\n                </argument>\n            </arguments>\n        </referenceBlock>\n    </body>\n</page>\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`VENDOR_MODULE/js/view/cart/totals/surcharge`}</inlineCode>{` component was defined earlier in the article.`}</p>\n    <p>{`If all has gone smoothly, when run, you should see the adjusted price reflected in the shopping cart.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}