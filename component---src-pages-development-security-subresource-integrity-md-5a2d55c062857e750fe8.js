"use strict";(self.webpackChunkcommerce_php=self.webpackChunkcommerce_php||[]).push([[17070],{38796:function(e,t,r){r.r(t),r.d(t,{_frontmatter:function(){return c},default:function(){return d}});var o=r(58168),a=r(80045),n=(r(88763),r(15680)),s=r(83407);const i=["components"],c={},p=(l="InlineAlert",function(e){return console.warn("Component "+l+" was not imported, exported, or provided by MDXProvider as global scope"),(0,n.mdx)("div",e)});var l;const m={_frontmatter:c},h=s.A;function d(e){let{components:t}=e,r=(0,a.A)(e,i);return(0,n.mdx)(h,(0,o.A)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,n.mdx)("h1",{id:"subresource-integrity"},"Subresource Integrity"),(0,n.mdx)("p",null,"Subresource Integrity (SRI) is a security feature that enables browsers to verify that the resources they fetch (for example, from a CDN) are delivered without unexpected manipulation. This feature works by allowing you to provide a cryptographic hash that a fetched resource must match.\nSee ",(0,n.mdx)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity"},"Subresource Integrity (SRI)")," to learn more about SRI."),(0,n.mdx)("h2",{id:"application-support"},"Application Support"),(0,n.mdx)("p",null,"To comply with PCI 4.0 requirements for verification of script integrity on payment pages, Adobe Commerce and Magento Open Source 2.4.7 and later include support for Subresource Integrity by providing integrity hashes for all Javascript assets residing in the local filesystem. (This\nfunctionality is defined in the Magento_Csp module.)"),(0,n.mdx)("h2",{id:"default-configuration"},"Default Configuration"),(0,n.mdx)("p",null,"The default SRI feature is implemented only on the payment pages for the admin and storefront areas. However, merchants can extend the default configuration to other pages. For example, to enable SRI on the customer account page in the storefront, create the file ",(0,n.mdx)("inlineCode",{parentName:"p"},"<module-dir>/view/frontend/layout/customer_account_index.xml")," with the following content:"),(0,n.mdx)("pre",null,(0,n.mdx)("code",{parentName:"pre",className:"language-xml"},'<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd">\n    <head>\n        <link src="Magento_Csp::js/sri.js"/>\n    </head>\n    <body>\n        <referenceBlock name="head.additional">\n            <block class="Magento\\Csp\\Block\\Sri\\Hashes" name="customer.account.index.sri.hashes" template="Magento_Csp::sri/hashes.phtml"/>\n        </referenceBlock>\n    </body>\n</page>\n')),(0,n.mdx)("h2",{id:"subresource-integrity-hash-generation"},"Subresource Integrity Hash Generation"),(0,n.mdx)("p",null,"The Subresource Integrity hash generation process begins once ",(0,n.mdx)("a",{parentName:"p",href:"https://experienceleague.adobe.com/en/docs/commerce-operations/configuration-guide/cli/static-view/static-view-file-deployment"},"static content")," for each package area has been deployed.\nThe ",(0,n.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/tree/2.4-develop/app/code/Magento/Csp/Model/Deploy/Package/Processor/PostProcessor"},"postprocessor")," class then systematically processes all javascript files within each package and generates integrity hashes.\nThe postprocessor class triggers the ",(0,n.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4-develop/app/code/Magento/Csp/Model/SubresourceIntegrityCollector.php"},"SubresourceIntegrityCollector")," class to collect the hashes which are cached for storage after all packages are deployed.\nAll integrity hashes are stored in cache via the ",(0,n.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4-develop/app/code/Magento/Csp/Model/SubresourceIntegrityRepository.php"},"SubresourceIntegrityRepository")," class."),(0,n.mdx)("h2",{id:"subresource-integrity-caching"},"Subresource Integrity Caching"),(0,n.mdx)("p",null,"Subresource Integrity hashes are stored and organized in cache by the deployed package area - frontend, base or admin.\nThe hash value for a specific file can be retrieved from the cache using the ",(0,n.mdx)("inlineCode",{parentName:"p"},"getByPath")," function in the ",(0,n.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4-develop/app/code/Magento/Csp/Model/SubresourceIntegrityRepository.php"},"SubresourceIntegrityRepository")," class."),(0,n.mdx)("p",null,"Caches can be purged in the following ways:"),(0,n.mdx)("ul",null,(0,n.mdx)("li",{parentName:"ul"},(0,n.mdx)("p",{parentName:"li"},"Programmatically, by using the ",(0,n.mdx)("inlineCode",{parentName:"p"},"deleteAll")," function in the ",(0,n.mdx)("a",{parentName:"p",href:"https://github.com/magento/magento2/blob/2.4-develop/app/code/Magento/Csp/Model/SubresourceIntegrityRepository.php"},"SubresourceIntegrityRepository")," class.")),(0,n.mdx)("li",{parentName:"ul"},(0,n.mdx)("p",{parentName:"li"},"Using the CLI"))),(0,n.mdx)("pre",null,(0,n.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento cache:flush\n")),(0,n.mdx)("ul",null,(0,n.mdx)("li",{parentName:"ul"},"Through the Admin UI via ",(0,n.mdx)("strong",{parentName:"li"},"System")," > ",(0,n.mdx)("strong",{parentName:"li"},"Tools")," > ",(0,n.mdx)("strong",{parentName:"li"},"Cache Management"),". ",(0,n.mdx)("strong",{parentName:"li"},"Flush Cache Storage"))),(0,n.mdx)(p,{slots:"text",mdxType:"InlineAlert"}),(0,n.mdx)("p",null,"After the cache has been purged, SRI caches must be regenerated using the static content deploy command."),(0,n.mdx)("pre",null,(0,n.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento setup:static-content:deploy\n")),(0,n.mdx)("h3",{id:"subresource-integrity-for-remote-resources"},"Subresource Integrity for Remote Resources"),(0,n.mdx)("p",null,"Although, there is no SRI support for custom remote Javascript resources currently, merchants can generate the integrity hash for remote resources using the following example."),(0,n.mdx)("pre",null,(0,n.mdx)("code",{parentName:"pre",className:"language-php"},'$hash = base64_encode(hash(\'sha256\', $content, true));\n$integrity = "sha256" . "-{$hash}";\n')),(0,n.mdx)(p,{slots:"text",mdxType:"InlineAlert"}),(0,n.mdx)("p",null,"For subresource-integrity verification of a resource served from an origin other than the document where it is embedded, the ",(0,n.mdx)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/crossorigin"},"crossorigin")," attribute must be provided along with the integrity attribute."))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-development-security-subresource-integrity-md-5a2d55c062857e750fe8.js.map