{"version":3,"file":"component---src-pages-development-components-catalog-rules-md-df1768bdbc52781ec184.js","mappings":"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","sources":["webpack://commerce-php/./src/pages/development/components/catalog-rules.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst InlineAlert = makeShortcode(\"InlineAlert\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"extend-catalog-rule-conditions\"\n    }}>{`Extend catalog rule conditions`}</h1>\n    <p>{`Catalog price rules can be used to offer products to buyers at a discounted price, based on a set of defined conditions. Catalog price rules do not use coupon codes. The discounts are applied to the final product price in the product listing and the product description page even before adding the product to the shopping cart.\nFor more information about catalog price rules, refer to `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.magento.com/user-guide/marketing/price-rules-catalog.html\"\n      }}>{`Catalog Rules`}</a>{`.`}</p>\n    <h2 {...{\n      \"id\": \"default-conditions\"\n    }}>{`Default conditions`}</h2>\n    <p>{`In the `}<inlineCode parentName=\"p\">{`Conditions`}</inlineCode>{` tab, Adobe Commerce and Magento Open Source have the following product attributes in the `}<inlineCode parentName=\"p\">{`add conditions`}</inlineCode>{` section.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"1280px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"49.375%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"display\": \"block\",\n            \"transition\": \"opacity 0.5s 0.5s\",\n            \"pointerEvents\": \"none\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/commerce-php/static/1fab8926a461a7378da7f4047662c8f4/5530d/conditions-section-v2.webp 320w\", \"/commerce-php/static/1fab8926a461a7378da7f4047662c8f4/0c8fb/conditions-section-v2.webp 640w\", \"/commerce-php/static/1fab8926a461a7378da7f4047662c8f4/94b1e/conditions-section-v2.webp 1280w\", \"/commerce-php/static/1fab8926a461a7378da7f4047662c8f4/91d04/conditions-section-v2.webp 1297w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/commerce-php/static/1fab8926a461a7378da7f4047662c8f4/dd4a7/conditions-section-v2.png 320w\", \"/commerce-php/static/1fab8926a461a7378da7f4047662c8f4/0f09e/conditions-section-v2.png 640w\", \"/commerce-php/static/1fab8926a461a7378da7f4047662c8f4/bbbf7/conditions-section-v2.png 1280w\", \"/commerce-php/static/1fab8926a461a7378da7f4047662c8f4/a8e5d/conditions-section-v2.png 1297w\"],\n            \"sizes\": \"(max-width: 1280px) 100vw, 1280px\",\n            \"type\": \"image/png\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/commerce-php/static/1fab8926a461a7378da7f4047662c8f4/bbbf7/conditions-section-v2.png\",\n            \"alt\": \"Catalog Rule Conditions\",\n            \"title\": \"Catalog Rule Conditions\",\n            \"loading\": \"lazy\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"opacity\": \"0\",\n              \"transition\": \"opacity 0.5s\",\n              \"color\": \"inherit\",\n              \"boxShadow\": \"inset 0px 0px 0px 400px none\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <h2 {...{\n      \"id\": \"implementation-of-existing-conditions\"\n    }}>{`Implementation of existing conditions`}</h2>\n    <p>{`In the `}<inlineCode parentName=\"p\">{`app/code/Magento/CatalogRule/etc/di.xml`}</inlineCode>{` configuration, the following `}<inlineCode parentName=\"p\">{`type`}</inlineCode>{` configuration is defined:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<type name=\"Magento\\\\CatalogRule\\\\Model\\\\Rule\\\\Condition\\\\Combine\">\n    <arguments>\n        <argument name=\"data\" xsi:type=\"array\">\n            <item name=\"form_name\" xsi:type=\"string\">catalog_rule_form</item>\n        </argument>\n    </arguments>\n</type>\n<type name=\"Magento\\\\CatalogRule\\\\Model\\\\Rule\\\\Condition\\\\Product\">\n    <arguments>\n        <argument name=\"data\" xsi:type=\"array\">\n            <item name=\"form_name\" xsi:type=\"string\">catalog_rule_form</item>\n        </argument>\n    </arguments>\n</type>\n`}</code></pre>\n    <p>{`In the above configuration, the `}<inlineCode parentName=\"p\">{`catalog_rule_form`}</inlineCode>{` is a UI component form. It is defined in `}<inlineCode parentName=\"p\">{`app/code/Magento/CatalogRule/view/adminhtml/ui_component/catalog_rule_form.xml`}</inlineCode>{`.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`Magento\\\\CatalogRule\\\\Model\\\\Rule\\\\Condition\\\\Combine`}</inlineCode>{` and the `}<inlineCode parentName=\"p\">{`Magento\\\\CatalogRule\\\\Model\\\\Rule\\\\Condition\\\\Product`}</inlineCode>{` classes contain the list of conditions and validations used for creating extended conditions.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`getNewChildSelectOptions`}</inlineCode>{` method in `}<inlineCode parentName=\"p\">{`app/code/Magento/CatalogRule/Model/Rule/Condition/Combine.php`}</inlineCode>{` is responsible for the listed conditions. It returns an array of the lists of valid conditions.`}</p>\n    <p>{`Below is the definition of `}<inlineCode parentName=\"p\">{`getNewChildSelectOptions`}</inlineCode>{` method:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`/**\n * @return array\n */\npublic function getNewChildSelectOptions()\n{\n    $productAttributes = $this->_productFactory->create()->loadAttributeOptions()->getAttributeOption();\n    $attributes = [];\n    foreach ($productAttributes as $code => $label) {\n        $attributes[] = [\n            'value' => 'Magento\\\\CatalogRule\\\\Model\\\\Rule\\\\Condition\\\\Product|' . $code,\n            'label' => $label,\n        ];\n    }\n    $conditions = parent::getNewChildSelectOptions();\n    $conditions = array_merge_recursive(\n        $conditions,\n        [\n            [\n                'value' => \\\\Magento\\\\CatalogRule\\\\Model\\\\Rule\\\\Condition\\\\Combine::class,\n                'label' => __('Conditions Combination'),\n            ],\n            ['label' => __('Product Attribute'), 'value' => $attributes]\n        ]\n    );\n    return $conditions;\n}\n`}</code></pre>\n    <p>{`In the above example, the `}<inlineCode parentName=\"p\">{`$conditions`}</inlineCode>{` array will contain the list of valid conditions. Each item in the array will have the `}<inlineCode parentName=\"p\">{`value`}</inlineCode>{` and the `}<inlineCode parentName=\"p\">{`label`}</inlineCode>{` key with the appropriate values.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`validate`}</inlineCode>{` method from the `}<inlineCode parentName=\"p\">{`app/code/Magento/CatalogRule/Model/Rule/Condition/Product.php`}</inlineCode>{` file is responsible for the validations of the conditions defined in the catalog price rules.`}</p>\n    <p>{`Below is the definition of the `}<inlineCode parentName=\"p\">{`validate`}</inlineCode>{` method:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`<?php\n/**\n * Copyright &copy; Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\nuse Magento\\\\Catalog\\\\Model\\\\Product;\nuse Magento\\\\Framework\\\\Model\\\\AbstractModel;\n\n/**\n * Validate product attribute value for condition\n *\n * @param Product|AbstractModel $model\n * @return bool\n */\npublic function validate(AbstractModel $model): bool\n{\n    $attrCode = $this->getAttribute();\n    if ('category_ids' === $attrCode) {\n        return parent::validate($model);\n    }\n\n    $oldAttrValue = $model->getData($attrCode);\n    if ($oldAttrValue === null) {\n        if ($this->getOperator() === '<=>') {\n            return true;\n        }\n        return false;\n    }\n\n    $this->_setAttributeValue($model);\n\n    $result = $this->validateAttribute($model->getData($attrCode));\n    $this->_restoreOldAttrValue($model, $oldAttrValue);\n\n    return (bool)$result;\n}\n`}</code></pre>\n    <p>{`In the above example, the `}<inlineCode parentName=\"p\">{`validate`}</inlineCode>{` method defines the logic to validate the specified conditions in the catalog price rule.`}</p>\n    <p>{`Note that the `}<inlineCode parentName=\"p\">{`app/code/Magento/CatalogRule/Model/Rule/Condition/Product.php`}</inlineCode>{` class extends from the `}<inlineCode parentName=\"p\">{`app/code/Magento/Rule/Model/Condition/Product/AbstractProduct.php`}</inlineCode>{` abstract class.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`app/code/Magento/Rule/Model/Condition/Product/AbstractProduct.php`}</inlineCode>{` abstract class extends from the `}<inlineCode parentName=\"p\">{`app/code/Magento/Rule/Model/Condition/AbstractCondition.php`}</inlineCode>{` class.`}</p>\n    <InlineAlert variant=\"info\" slots=\"text\" mdxType=\"InlineAlert\" />\n    <p>{`The validation class for the catalog price rule must extend the `}<inlineCode parentName=\"p\">{`Magento\\\\Rule\\\\Model\\\\Condition\\\\AbstractCondition`}</inlineCode>{` class.`}</p>\n    <h2 {...{\n      \"id\": \"steps-to-extend-catalog-rule-conditions\"\n    }}>{`Steps to extend catalog rule conditions`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Create the `}<inlineCode parentName=\"li\">{`after`}</inlineCode>{` plugin for the `}<inlineCode parentName=\"li\">{`getNewChildSelectOptions`}</inlineCode>{` method and add your custom condition to it.`}</li>\n      <li parentName=\"ul\">{`Add the `}<inlineCode parentName=\"li\">{`type`}</inlineCode>{` configuration in `}<inlineCode parentName=\"li\">{`<custom_module_dir>/etc/di.xml`}</inlineCode>{`.`}</li>\n      <li parentName=\"ul\">{`Create a class that extends the `}<inlineCode parentName=\"li\">{`Magento\\\\Rule\\\\Model\\\\Condition\\\\AbstractCondition`}</inlineCode>{` class. Then define the `}<inlineCode parentName=\"li\">{`validate`}</inlineCode>{` method with your custom logic.`}</li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","InlineAlert","name","props","console","warn","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","mdxType","parentName","variant","slots","isMDXComponent"],"sourceRoot":""}