---
title: Bulk Operations | Commerce PHP Extensions
description: Improve performance for Admin users by implementing bulk operations for Adobe Commerce and Magento Open Source.
keywords:
  - Extensions
---

# Bulk operations

Bulk operations are actions that are performed on a large scale. Example bulk operations tasks include importing or exporting items, changing prices on a mass scale, and assigning products to a warehouse.

For each individual task of a bulk operation, the system creates a message that is published in a [message queue](https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/message-queues/message-queue-framework.html). A consumer runs in the background and processes the messages that it receives. Because tasks are processed in the background through the message queue system, when a merchant launches a bulk operation from the Admin panel, control is quickly returned to the merchant. In previous releases, the merchant could not use the Admin panel until all tasks were completed.

The primary Bulk Operation interface is `OperationInterface`. It defines the getter and setter methods the bulk operation uses to create and process messages. The following interfaces are also used:

Interface | Description
--- | ---
BulkManagementInterface | Schedules and deletes bulk operation requests
BulkStatusInferface | Returns the status of bulk operations
BulkSummaryInterface | Provides details about a bulk operation
OperationManagementInterface | Changes the status of an operation

Three clients call bulk operation APIs:

*  A publisher, which pushes messages to the message queue
*  A consumer, which handles each specific operation
*  A client that gets the status of the bulk operation and shows the list of failed operations

## Publish bulk operations

The `BulkManagementInterface::scheduleBulk` is responsible for publishing bulk operations. The following table describes its arguments.

<table>
    <tr>
        <th>Parameter</th>
        <th>Type</th>
        <th>Description</th>
    </tr>
    <tr>
        <td><inlineCode class="spectrum-Body--sizeS">$bulkUuid</inlineCode></td>
        <td>string</td>
        <td>Bulk identifier generated by <inlineCode class="spectrum-Body--sizeS">Magento\Framework\DataObject\IdentityGeneratorInterface::generateId</inlineCode></td>
    </tr>
    <tr>
        <td><inlineCode class="spectrum-Body--sizeS">$operations</inlineCode></td>
        <td>array</td>
        <td>
            <ul>
                <li>topic_name - Must be defined in the <inlineCode class="spectrum-Body--sizeS">communication.xml</inlineCode> and queue configuration files. It can also be used in one of the Asynchonous API pre-generated topics.</li>
                <li>bulk_uuid - A bulk identifier</li>
                <li>status - The default operation status <inlineCode class="spectrum-Body--sizeS">OperationInterface::STATUS_TYPE_OPEN</inlineCode></li>
                <li>serialized_data - An array of serialized data with the following required keys:</li>
                <ul>
                    <li>entity_id - Your <a href="https://experienceleague.adobe.com/en/docs/commerce-operations/operational-playbook/glossary#entity">entity</a> ID</li>
                    <li>entity_link - Link to your entity</li>
                    <li>meta_information - String that describes your entity. For example, "SKU: Simple_Product"</li>
                </ul>
                <p>This data is required to display the results of operations couldn't be executed for any non-recoverable reason. These results are displayed in the failed operations grid.</p>
                <p>You also can add any data needed to execute operations. For example, if you are conducting a mass price update, you can add price data.</p>
            </ul>
        </td>
    </tr>
    <tr>
        <td><inlineCode class="spectrum-Body--sizeS">$bulkDescription</inlineCode></td>
        <td>string</td>
        <td>A description of the bulk operation. This value is displayed in the <b>Your Bulk Operations</b> grid.</td>
    </tr>
    <tr>
        <td><inlineCode class="spectrum-Body--sizeS">$userId</inlineCode></td>
        <td>int</td>
        <td>The Admin user ID that executes this bulk operation.</td>
    </tr>
</table>

See [Create a publisher](bulk-operations-example.md#create-a-publisher) for a detailed example of a publisher.

## Consume messages

When a consumer processes a message, it must notify the system of its status. The status can be OPEN, COMPLETE, RETRIABLY_FAILED, and NOT_RETRIABLY_FAILED.

To send this notification, use `OperationManagementInterface::changeOperationStatus($operationId, $status, $errorCode = null, $message = null, $data = null)`.

### Handling recoverable exceptions

Adobe Commerce and Magento Open Source provide database exception classes to simplify the process of identifying recoverable database errors in client code. In most cases, such errors happen due to some environment issues and can be fixed. The full path to these classes is `Magento\Framework\DB\Adapter\<class_name>`. These exceptions extend generic `\Zend_Db_Adapter_Exception`.

Exception class | Description of database error(s)
--- | ---
ConnectionException | SQLSTATE[HY000]: General error: 2006 MySQL server has gone away <br />SQLSTATE[HY000]: General error: 2013 Lost connection to MySQL server during query
LockWaitException | SQLSTATE[HY000]: General error: 1205 Lock wait timeout exceeded
DeadlockException | SQLSTATE[40001]: Serialization failure: 1213 Deadlock found when trying to get lock

The following pseudocode illustrates how to recover from database-related errors.

```php
<?php
namespace example;
use Magento\Framework\DB\Adapter\LockWaitException;

// ...
try {
    // do something
} catch (LockWaitException $exception) {
    // try to recover from exception
}
```

See [Create a consumer](bulk-operations-example.md#create-a-consumer) for a detailed example of a consumer.

## Get the status of operations

Use `getBulkStatus(UuidInterface $bulkId)` to get the status of the overall bulk operation.  Possible values are

Value | Constant
--- | ---
0 | NOT_STARTED
1 | IN_PROGRESS
2 | FINISHED_SUCCESSFULLY
3 | FINISHED_WITH_FAILURE
