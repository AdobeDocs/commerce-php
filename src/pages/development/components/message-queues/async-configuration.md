---
title: Asynchronous Configuration | Commerce PHP Extensions
description: Learn about the important configuration files that you must configure in your Adobe commerce and Magento Open Source extensions.
contributor_name: comwrap GmbH
contributor_link: https://www.comwrap.com
keywords:
  - Extensions
---

# Asynchronous configuration

When using the message queue, four configuration files in your component must be updated:

*  communication.xml
*  queue_consumer.xml
*  queue_topology.xml
*  queue_publisher.xml

More information can be found in [Configure message queues](configuration.md).

Asynchronous and Bulk APIs are built on top of the usual REST API and use the Message Queue Framework for processing messages. To ease development efforts, the Asynchronous API pre-generates the following configuration files:

*  communication.xml
*  queue_publisher.xml

and provides the `queue_topology.xml` and `queue_consumer.xml` files within the `Magento/WebapiAsync` module.

## communication.xml

Information about the auto-generation of `communication.xml` can be found in [Topics in Asynchronous API](async-topics.md)

## queue_publisher.xml

The `queue_publisher.xml` file is generated by the `\Magento\WebapiAsync\Code\Generator\Config\RemoteServiceReader\Publisher` class, which implements `\Magento\Framework\Config\ReaderInterface` and is injected into the `\Magento\Framework\MessageQueue\Publisher\Config\CompositeReader` constructor argument in the main `di.xml` file.

```xml
<type name="Magento\Framework\MessageQueue\Publisher\Config\CompositeReader">
    <arguments>
        <argument name="readers" xsi:type="array">
            <item name="asyncServiceReader" xsi:type="object" sortOrder="0">Magento\WebapiAsync\Code\Generator\Config\RemoteServiceReader\Publisher</item>
            ...
        </argument>
    </arguments>
</type>
```

The sort order is set to 0 and allows developers to change some aspects of the generated configuration in configuration readers such as `queue_publisher.xml` and `env.php`.

`\Magento\WebapiAsync\Code\Generator\Config\RemoteServiceReader\Publisher::read()` calls `\Magento\AsynchronousOperations\Model\ConfigInterface::getServices()` to get an array of all REST API routes which can be executed asynchronously. Then it defines the connection name as `amqp` (or `stomp` for ActiveMQ Artemis) and the exchange as `magento` for each generated topic name.

## queue_consumer.xml

The asynchronous/bulk API has one defined consumer which processes all asynchronous/bulk APIs messages.

```xml
<consumer name="async.operations.all" queue="async.operations.all"
              consumerInstance="Magento\AsynchronousOperations\Model\MassConsumer"/>
```

The connection type (AMQP or STOMP) is determined automatically based on your `env.php` configuration.

### queue_topology.xml

The message queue topology configuration links all auto-generated topic names with prefix `async.` to the `magento` exchange and defines the queue named `async.operations.all` as the destination for all messages.

```xml
<exchange name="magento">
    <binding id="async.operations.all" topic="async.#" destination="async.operations.all"/>
</exchange>
```

The connection type is automatically determined from your `env.php` configuration.

<InlineAlert variant="info" slots="text"/>

Message queues connection is defined dynamically based on deployment configuration in `env.php`. If AMQP or STOMP is configured in deployment configuration of the queue, the respective connection is used. Otherwise, db connection is used.
As a result, if AMQP or STOMP is configured in deployment configuration of the queue, connection declaration can be omitted in [message queue configuration files](./configuration.md): `queue_customer.xml`, `queue_publisher.xml`, `queue_topology.xml`.

<InlineAlert variant="info" slots="text"/>

ActiveMQ Artemis (STOMP) was introduced in Adobe Commerce 2.4.6 and later versions. For STOMP connections, use ANYCAST addressing mode for point-to-point message delivery and load balancing across multiple consumers.
